<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signal Bot - DragLab</title>
    <style>
        /* MEN√ö UNIVERSAL INLINE */
        .universal-menu {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }
        .universal-menu .menu-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(102, 126, 234, 0.9);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .universal-menu .menu-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        .universal-menu-content {
            position: absolute;
            right: 0;
            top: 60px;
            background: white;
            min-width: 250px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .universal-menu-content.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .universal-menu-content a,
        .universal-menu-content button {
            display: block;
            width: 100%;
            padding: 12px 20px;
            text-decoration: none;
            color: #333;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .universal-menu-content a:hover,
        .universal-menu-content button:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .universal-menu-content .menu-divider {
            height: 1px;
            background: rgba(0,0,0,0.1);
            margin: 5px 0;
        }
        body.dark-mode .universal-menu-content {
            background: #1e1e2e;
        }
        body.dark-mode .universal-menu-content a,
        body.dark-mode .universal-menu-content button {
            color: #fff;
        }
        body.dark-mode .universal-menu-content .menu-divider {
            background: rgba(255,255,255,0.1);
        }
        /* FIN MEN√ö UNIVERSAL */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s, color 0.3s;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
            color: #f0f0f0;
        }

        body.dark-mode .section {
            background: #1e1e2e;
            color: #f0f0f0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
        }

        body.dark-mode .file-item {
            background: #2a2a3e;
            color: #f0f0f0;
            border: 1px solid #3a3a4e;
        }

        body.dark-mode .stat-box {
            background: #2a2a3e;
            color: #f0f0f0;
            border: 2px solid #3a3a4e;
        }

        body.dark-mode .info-box {
            background: #252535;
            color: #f0f0f0;
            border-left-color: #667eea;
        }

        body.dark-mode select,
        body.dark-mode input {
            background: #2a2a3e;
            color: #f0f0f0;
            border-color: #4a4a6e;
        }

        body.dark-mode select:focus,
        body.dark-mode input:focus {
            border-color: #667eea;
            background: #323244;
        }

        body.dark-mode .section-header h2,
        body.dark-mode h2,
        body.dark-mode h3 {
            color: #ffffff;
        }

        body.dark-mode label {
            color: #d0d0d0;
        }

        body.dark-mode .file-name {
            color: #f0f0f0;
        }

        body.dark-mode .stat-box p {
            color: #ffffff;
        }

        body.dark-mode .file-size {
            color: #b0b0b0;
        }

        body.dark-mode small {
            color: #c0c0c0;
        }
        
        body.dark-mode p,
        body.dark-mode li {
            color: #e0e0e0;
        }
        
        body.dark-mode strong {
            color: #ffffff;
        }
        
        body.dark-mode .palette-title {
            color: #ffffff;
            font-weight: 700;
        }
        
        body.dark-mode .blocks-palette {
            background: #1e1e2e;
            border-color: #444;
        }
        
        body.dark-mode .drop-zone {
            background: #1e1e2e;
            border-color: #555;
        }
        
        body.dark-mode .drop-zone-title {
            color: #fff;
            font-weight: 600;
        }
        
        body.dark-mode .drop-zone-empty {
            color: #aaa;
        }
        
        body.dark-mode .info-text {
            color: #e0e0e0 !important;
        }
        
        /* Mejor contraste para fondos claros en modo oscuro */
        body.dark-mode [style*="background: #e3f2fd"],
        body.dark-mode [style*="background: #f3e5f5"],
        body.dark-mode [style*="background: #fff3e0"],
        body.dark-mode [style*="background: #e8f5e9"],
        body.dark-mode [style*="background: #f8f9fa"],
        body.dark-mode [style*="background: #fff3cd"],
        body.dark-mode [style*="background: #f8d7da"],
        body.dark-mode [style*="background: #e7f3ff"] {
            background: #2a2a3e !important;
            color: #e0e0e0 !important;
        }
        
        body.dark-mode [style*="background: linear-gradient"] {
            color: #ffffff !important;
        }
        
        body.dark-mode [style*="background: #e3f2fd"] *:not(.dropped-block):not(.dropped-block *),
        body.dark-mode [style*="background: #f3e5f5"] *:not(.dropped-block):not(.dropped-block *),
        body.dark-mode [style*="background: #fff3e0"] *:not(.dropped-block):not(.dropped-block *),
        body.dark-mode [style*="background: #e8f5e9"] *:not(.dropped-block):not(.dropped-block *),
        body.dark-mode [style*="background: #f8f9fa"] *:not(.dropped-block):not(.dropped-block *),
        body.dark-mode [style*="background: #fff3cd"] *:not(.dropped-block):not(.dropped-block *),
        body.dark-mode [style*="background: #f8d7da"] *:not(.dropped-block):not(.dropped-block *),
        body.dark-mode [style*="background: #e7f3ff"] *:not(.dropped-block):not(.dropped-block *) {
            color: #e0e0e0 !important;
        }
        
        body.dark-mode [style*="background: #f8f9fa"] h4,
        body.dark-mode [style*="background: #fff3cd"] h4 {
            color: #ffffff !important;
        }
        
        body.dark-mode .auto-download-text {
            color: #ffffff !important;
        }
        
        /* Asegurar que dropped-block en modo oscuro mantenga colores oscuros */
        body.dark-mode .dropped-block,
        body.dark-mode .dropped-block * {
            background-color: inherit;
            color: inherit;
        }
        
        body.dark-mode .dropped-block label,
        body.dark-mode .dropped-block input,
        body.dark-mode .dropped-block select {
            color: #e0e0e0;
        }

        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            backdrop-filter: blur(10px);
            z-index: 1000;
            transition: all 0.3s;
        }

        .lang-toggle {
            position: fixed;
            top: 20px;
            right: 180px;
            background: rgba(255, 100, 150, 0.3);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            backdrop-filter: blur(10px);
            z-index: 1000;
            transition: all 0.3s;
        }

        .dark-mode-toggle:hover,
        .lang-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        body.dark-mode .dark-mode-toggle,
        body.dark-mode .lang-toggle {
            background: rgba(100, 100, 120, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Bot√≥n de Retroceder */
        .btn-back {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            z-index: 1001;
        }
        
        .btn-back:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            background: rgba(255,255,255,0.3);
        }
        
        body.dark-mode .btn-back {
            background: rgba(30,30,46,0.8);
            border-color: rgba(255,255,255,0.2);
        }
        
        /* Men√∫ Desplegable */
        .nav-menu-wrapper {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
        }
        
        .menu-toggle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        
        .menu-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            background: rgba(255,255,255,0.3);
        }
        
        body.dark-mode .menu-toggle {
            background: rgba(30,30,46,0.8);
            border-color: rgba(255,255,255,0.2);
        }
        
        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 60px;
            background: rgba(255,255,255,0.95);
            min-width: 200px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            overflow: hidden;
            backdrop-filter: blur(20px);
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .dropdown-menu.active {
            display: block;
        }
        
        .dropdown-menu a,
        .dropdown-menu button {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 18px;
            text-decoration: none;
            color: #1a1a2e;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .dropdown-menu a:hover,
        .dropdown-menu button:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        body.dark-mode .dropdown-menu {
            background: rgba(30,30,46,0.95);
        }
        
        body.dark-mode .dropdown-menu a,
        body.dark-mode .dropdown-menu button {
            color: #e0e0e0;
        }
        
        body.dark-mode .dropdown-menu a:hover,
        body.dark-mode .dropdown-menu button:hover {
            background: rgba(102,126,234,0.2);
        }

        body.dark-mode button.btn {
            background: linear-gradient(135deg, #7b8ff0 0%, #9060c2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(123, 143, 240, 0.3);
        }

        body.dark-mode button.btn:hover {
            background: linear-gradient(135deg, #8a9ef5 0%, #a070d2 100%);
        }

        body.dark-mode .section-header {
            border-bottom-color: #3a3a4e;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        body.dark-mode .section {
            background: #1a1a2e;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #f0f0f0;
        }

        .section-icon {
            font-size: 2em;
        }

        .section-header h2 {
            color: #333;
            font-size: 1.8em;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input[type="text"],
        input[type="date"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.85em;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        body.dark-mode .btn-secondary {
            background: linear-gradient(135deg, #34a853 0%, #2dd4bf 100%);
            box-shadow: 0 4px 15px rgba(52, 168, 83, 0.3);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-box {
            display: none;
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
        }

        .result-box.show {
            display: block;
        }

        .result-box.success {
            background: #d4edda;
            border-left: 5px solid #28a745;
            color: #155724;
        }

        .result-box.error {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
            color: #721c24;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box.positive {
            background: #d4edda;
            border: 2px solid #28a745;
        }

        .stat-box.negative {
            background: #f8d7da;
            border: 2px solid #dc3545;
        }

        .stat-box h3 {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        body.dark-mode .stat-box h3 {
            color: #c0c0c0;
        }

        .stat-box p {
            font-size: 1.4em;
            font-weight: 600;
            color: #333;
        }

        body.dark-mode .stat-box.positive {
            background: #1a3d2a;
            border-color: #4ade80;
        }

        body.dark-mode .stat-box.negative {
            background: #3d1a1a;
            border-color: #f87171;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .info-box strong {
            color: #1976D2;
        }

        .info-box small {
            display: block;
            margin-top: 5px;
            color: #555;
        }

        body.dark-mode .info-box small {
            color: #d0d0d0;
        }

        body.dark-mode .info-box strong {
            color: #8a9ef5;
        }

        body.dark-mode .result-box.success {
            background: #1a3d2a;
            border-left-color: #4ade80;
            color: #c0f0d0;
        }

        body.dark-mode .result-box.error {
            background: #3d1a1a;
            border-left-color: #f87171;
            color: #f0c0c0;
        }

        .files-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
        }

        body.dark-mode .files-list {
            border-color: #3a3a4e;
            background: #1e1e2e;
        }

        .file-item {
            background: #f8f9fa;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            font-weight: 500;
            color: #333;
        }

        .file-size {
            color: #666;
            font-size: 0.9em;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
        }

        .file-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
        }

        .file-status.not-found {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
        }

        body.dark-mode .file-status.not-found {
            background: #3d3520;
            color: #f0d080;
            border-color: #8a7030;
        }

        body.dark-mode .loading p {
            color: #f0f0f0;
        }

        body.dark-mode .spinner {
            border-color: #3a3a4e;
            border-top-color: #8a9ef5;
        }

        .tip-box {
            margin-top: 15px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 5px;
        }

        body.dark-mode .tip-box {
            background: #3d3520;
            color: #f0d080;
            border: 1px solid #8a7030;
        }

        body.dark-mode .tip-box strong {
            color: #ffd080;
        }

        .config-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        body.dark-mode .config-box {
            background: #2a2a3e !important;
            border: 1px solid #3a3a4e;
        }

        body.dark-mode .config-box h3 {
            color: #ffffff !important;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        .config-item {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        body.dark-mode .config-item {
            border-bottom-color: #3a3a4e;
        }

        .config-label {
            font-weight: 600;
            color: #666;
        }

        body.dark-mode .config-label {
            color: #b0b0b0;
        }

        .config-value {
            color: #333;
            margin-left: 10px;
        }

        body.dark-mode .config-value {
            color: #f0f0f0;
        }

        .stats-title {
            margin-bottom: 15px;
            color: #333;
        }

        body.dark-mode .stats-title {
            color: #ffffff;
        }

        .section-subtitle {
            margin-bottom: 15px;
            color: #333;
        }

        body.dark-mode .section-subtitle {
            color: #ffffff;
        }

        .info-text {
            color: #666;
            line-height: 1.8;
        }

        body.dark-mode .info-text {
            color: #d0d0d0;
        }

        /* ==================== STRATEGY BUILDER ==================== */
        .strategy-builder {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }
        
        .blocks-palette {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            max-height: none;
            overflow: visible;
            transition: opacity 0.2s ease;
        }
        
        .builder-canvas {
            transition: background 0.2s ease;
        }
        
        /* Cuando se arrastra, la paleta se oculta */
        .blocks-palette.dragging {
            opacity: 0;
            pointer-events: none;
        }
        
        .builder-canvas.dragging-active {
            background: rgba(102, 126, 234, 0.05);
        }

        .palette-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        body.dark-mode .blocks-palette {
            background: #1e1e2e;
            border-color: #444;
        }

        .palette-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            font-size: 0.9em;
            text-transform: uppercase;
        }

        body.dark-mode .palette-title {
            color: #fff;
            font-weight: 700;
        }

        .block {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: move;
            font-size: 0.9em;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .block:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .block.indicator {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .block.condition {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .block.value {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .block.operator {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .block-icon {
            margin-right: 8px;
        }

        .builder-canvas {
            background: #ffffff;
            border-radius: 10px;
            padding: 20px;
            border: 2px dashed #ddd;
            min-height: 600px;
            transition: background 0.2s ease;
        }

        body.dark-mode .builder-canvas {
            background: #1e1e2e;
            border-color: #3a3a4e;
        }

        .drop-zone {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 100px;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        body.dark-mode .drop-zone {
            background: #2a2a3e;
            border-color: #667eea;
        }

        .drop-zone.drag-over {
            background: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .drop-zone-title {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        body.dark-mode .drop-zone-title {
            color: #8a9ef5;
        }

        .drop-zone-empty {
            text-align: center;
            color: #999;
            padding: 30px;
            font-style: italic;
        }

        body.dark-mode .drop-zone-empty {
            color: #666;
        }

        .dropped-block {
            background: #ffffff;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        body.dark-mode .dropped-block {
            background: #2a2a3e !important;
            border-color: #8a9ef5;
            color: #e0e0e0;
        }

        .dropped-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .dropped-block-title {
            font-weight: 600;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.dark-mode .dropped-block-title {
            color: #8a9ef5;
        }

        .block-actions {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .move-block {
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .move-block:hover {
            background: #5568d3;
        }

        .move-block:disabled {
            background: #cccccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        body.dark-mode .move-block {
            background: #8a9ef5;
        }

        body.dark-mode .move-block:hover {
            background: #7a8ee5;
        }

        .remove-block {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
        }

        .remove-block:hover {
            background: #c82333;
        }

        .block-params {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .param-group {
            margin-bottom: 0;
        }

        .param-group label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        body.dark-mode .param-group label {
            color: #b0b0b0;
        }

        .param-group input,
        .param-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .strategy-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .chart-iframe {
            width: 100%;
            height: 800px;
            border: none;
            border-radius: 10px;
        }

        /* ==================== RESPONSIVE MOBILE ==================== */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .dark-mode-toggle {
                top: 10px;
                right: 10px;
                padding: 8px 15px;
                font-size: 14px;
            }

            .header h1 {
                font-size: 2em;
            }

            .header p {
                font-size: 1em;
            }

            .section {
                padding: 20px 15px;
                margin-bottom: 20px;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .section-header h2 {
                font-size: 1.4em;
            }

            .section-icon {
                font-size: 1.5em;
            }

            .grid-2 {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 10px;
            }

            .config-grid {
                grid-template-columns: 1fr;
            }

            .stat-box {
                padding: 12px;
            }

            .stat-box h3 {
                font-size: 0.75em;
            }

            .stat-box p {
                font-size: 1.2em;
            }

            .btn {
                padding: 12px 20px;
                font-size: 14px;
            }

            input[type="text"],
            input[type="date"],
            input[type="number"],
            select {
                padding: 10px;
                font-size: 16px; /* Evita zoom en iOS */
            }

            .files-list {
                max-height: 200px;
            }

            .file-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .radio-group {
                flex-direction: column;
                gap: 10px;
            }

            .config-box {
                padding: 15px;
            }

            .config-item {
                font-size: 0.9em;
            }

            .info-text {
                font-size: 0.95em;
            }

            /* Mejorar iframe en m√≥vil */
            iframe {
                height: 400px !important;
            }

            .chart-iframe {
                height: 400px !important;
            }
        }

        @media (max-width: 480px) {
            .dark-mode-toggle {
                top: 10px;
                right: 10px;
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .lang-toggle {
                top: 55px;
                right: 10px;
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .header h1 {
                font-size: 1.5em;
                padding: 10px 0;
                padding-top: 50px;
            }

            .header p {
                font-size: 0.85em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-box h3 {
                font-size: 0.85em;
            }

            .section {
                padding: 15px 10px;
                margin-bottom: 15px;
            }

            .section-header h2 {
                font-size: 1.3em;
            }

            .chart-iframe {
                height: 300px !important;
            }

            iframe {
                height: 300px !important;
            }

            .strategy-builder {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }

            .blocks-palette {
                grid-template-columns: 1fr !important;
                gap: 10px;
                padding: 12px;
                max-height: none;
                overflow: visible;
            }
            
            .palette-section {
                margin-bottom: 12px;
            }
            
            .palette-title {
                font-size: 0.95em;
                margin-bottom: 10px;
            }
            
            .block {
                padding: 10px;
                font-size: 0.85em;
                margin-bottom: 6px;
                min-height: 50px;
            }
            
            .block small {
                font-size: 0.7em;
                display: block;
                margin-top: 3px;
            }
            
            .drop-zone {
                min-height: 100px;
            }
            
            .drop-zone-title {
                font-size: 0.9em;
                padding: 8px;
            }
            
            .drop-zone-empty {
                font-size: 0.85em;
                padding: 15px;
            }
            
            .builder-canvas {
                max-height: none;
                overflow-y: visible;
            }

            .block-params {
                grid-template-columns: 1fr;
            }
        }

        /* ==================== MODAL DISCLAIMER ==================== */
        .disclaimer-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .disclaimer-modal.show,
        .disclaimer-modal.active {
            display: flex;
        }

        .disclaimer-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s ease;
        }

        body.dark-mode .disclaimer-content {
            background: #1e1e2e;
            color: #f0f0f0;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .disclaimer-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        body.dark-mode .disclaimer-header {
            border-bottom-color: #3a3a4e;
        }

        .disclaimer-header h2 {
            margin: 0;
            color: #dc3545;
            font-size: 1.5em;
        }

        body.dark-mode .disclaimer-header h2 {
            color: #ff6b6b;
        }

        .disclaimer-text {
            margin-bottom: 25px;
            line-height: 1.8;
        }

        .disclaimer-text p {
            margin-bottom: 15px;
        }

        .disclaimer-text strong {
            color: #dc3545;
        }

        body.dark-mode .disclaimer-text strong {
            color: #ff6b6b;
        }

        .disclaimer-list {
            background: #fff3cd;
            padding: 15px 20px;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
            margin-bottom: 20px;
        }

        body.dark-mode .disclaimer-list {
            background: #3d3520;
            border-left-color: #f0ad4e;
        }

        .disclaimer-list ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .disclaimer-list li {
            margin: 8px 0;
        }

        .disclaimer-checkbox {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            border: 2px solid #dee2e6;
            transition: all 0.3s;
        }

        body.dark-mode .disclaimer-checkbox {
            background: #2a2a3e;
            border-color: #4a4a6e;
        }

        .disclaimer-checkbox:hover {
            border-color: #667eea;
            background: #e7f3ff;
        }

        body.dark-mode .disclaimer-checkbox:hover {
            border-color: #667eea;
            background: #323244;
        }

        .disclaimer-checkbox input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .disclaimer-checkbox label {
            cursor: pointer;
            font-weight: 600;
            margin: 0;
            flex: 1;
        }

        .disclaimer-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .disclaimer-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .disclaimer-btn-cancel {
            background: #6c757d;
            color: white;
        }

        .disclaimer-btn-cancel:hover {
            background: #5a6268;
        }

        .disclaimer-btn-accept {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .disclaimer-btn-accept:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .disclaimer-btn-accept:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ==================== STRATEGY TRANSLATOR SECTION ==================== */
        #strategy_translator_section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        body.dark-mode #strategy_translator_section {
            background: linear-gradient(135deg, #5568d3 0%, #6a3d8f 100%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
        }

        #strategy_human_readable {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            line-height: 1.8;
            white-space: pre-line;
            border: 1px solid rgba(255,255,255,0.2);
            max-height: 300px;
            overflow-y: auto;
        }

        body.dark-mode #strategy_human_readable {
            background: rgba(0,0,0,0.2);
            border-color: rgba(255,255,255,0.15);
        }

        #strategy_human_readable::-webkit-scrollbar {
            width: 8px;
        }

        #strategy_human_readable::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        #strategy_human_readable::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        #strategy_human_readable::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.4);
        }

        #strategy_translator_section h4 {
            color: white !important;
            font-weight: 600;
        }

        #strategy_translator_section small {
            color: rgba(255,255,255,0.8) !important;
        }

        /* ==================== SYMBOL PREVIEW ==================== */
        #full_symbol_preview {
            color: #333 !important;
        }

        body.dark-mode #full_symbol_preview {
            color: #f0f0f0 !important;
        }

        body.dark-mode [style*="background: #e7f3ff"] {
            background: #1e2a3a !important;
        }

        body.dark-mode [style*="background: rgba(102, 126, 234, 0.1)"] {
            background: rgba(102, 126, 234, 0.2) !important;
        }

        /* ==================== LOADER OVERLAY ==================== */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 99999;
            transition: opacity 0.3s;
        }

        .loader-overlay.active {
            display: flex;
            opacity: 1;
        }

        .loader-content {
            background: white;
            padding: 30px 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .loader-content {
            background: #1e1e2e;
        }

        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        body.dark-mode .loader-spinner {
            border: 4px solid #2a2a3e;
            border-top: 4px solid #7b8ff0;
        }

        .loader-text {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        body.dark-mode .loader-text {
            color: #fff;
        }

        .loader-subtext {
            font-size: 0.9em;
            color: #666;
        }

        body.dark-mode .loader-subtext {
            color: #aaa;
        }
    </style>
</head>
<body>
    <!-- Loader Overlay -->
    <div class="loader-overlay" id="loaderOverlay">
        <div class="loader-content">
            <div class="loader-spinner"></div>
            <div class="loader-text" id="loaderText">Procesando...</div>
            <div class="loader-subtext" id="loaderSubtext">Por favor espere</div>
        </div>
    </div>

    <!-- Bot√≥n de Retroceder -->
    <button class="btn-back" onclick="window.location.href='/trading-bot'" title="Volver">‚Üê</button>
    
    <!-- MEN√ö UNIVERSAL -->
    <div class="universal-menu">
        <button class="menu-btn" onclick="toggleUniversalMenu()" title="Men√∫">‚ò∞</button>
        <div class="universal-menu-content" id="universalMenu">
            <a href="/">üè† Inicio</a>
            <a href="/backtest">üß± Visual Strategy Builder</a>
            <a href="/trading-bot">ü§ñ Trading Bot</a>
            <div class="menu-divider"></div>
            <a href="/user-panel">üë§ Mi Cuenta</a>
            <a href="/subscriptions">üíé Suscripciones</a>
            <a href="/admin/panel" id="adminMenuLink" style="display: none;">üîí Panel Admin</a>
            <div class="menu-divider"></div>
            <button onclick="toggleDarkMode()">üåô Modo Oscuro</button>
            <button onclick="toggleLanguage()">üåê Idioma</button>
            <div class="menu-divider"></div>
            <button onclick="logout()">üö™ Cerrar Sesi√≥n</button>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1 data-lang-es="üì° Signal Bot - Se√±ales de Trading en Telegram" data-lang-en="üì° Signal Bot - Trading Signals on Telegram">üì° Signal Bot - Se√±ales de Trading en Telegram</h1>
            <p data-lang-es="Crea estrategias mediante Bloques - SIN Programar - Recibe se√±ales autom√°ticas en Telegram" data-lang-en="Build strategies with Blocks - NO Coding - Receive automatic signals on Telegram">Crea estrategias mediante Bloques - SIN Programar - Recibe se√±ales autom√°ticas en Telegram</p>
        </div>

        <!-- SECCI√ìN 1: GU√çA DE USO -->
        <div class="section">
            <div class="section-header">
                <span class="section-icon">ÔøΩ</span>
                <h2 data-lang-es="Guia de Uso" data-lang-en="User Guide">1. Gu√≠a de Uso</h2>
            </div>

            <div class="info-text" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 20px;">
                <h3 style="margin-top: 0; color: white;" data-lang-es="üéØ C√≥mo Funciona Visual Strategy Builder" data-lang-en="üéØ How Visual Strategy Builder Works">üéØ C√≥mo Funciona Visual Strategy Builder</h3>
                <p style="margin: 15px 0; line-height: 2; font-size: 1.05em;">
                    <strong data-lang-es="Paso 1:" data-lang-en="Step 1:">Paso 1:</strong> <span data-lang-es="Arrastra bloques desde la paleta al √°rea de construcci√≥n" data-lang-en="Drag blocks from the palette to the build area">Arrastra bloques desde la paleta al √°rea de construcci√≥n</span><br>
                    <strong data-lang-es="Paso 2:" data-lang-en="Step 2:">Paso 2:</strong> <span data-lang-es="Combina Indicadores (EMA, RSI, etc.) con Operadores (>, <, etc.)" data-lang-en="Combine Indicators (EMA, RSI, etc.) with Operators (>, <, etc.)">Combina Indicadores (EMA, RSI, etc.) con Operadores (>, <, etc.)</span><br>
                    <strong data-lang-es="Paso 3:" data-lang-en="Step 3:">Paso 3:</strong> <span data-lang-es="Usa bloques de L√≥gica (AND, OR) para condiciones complejas" data-lang-en="Use Logic blocks (AND, OR) for complex conditions">Usa bloques de L√≥gica (AND, OR) para condiciones complejas</span><br>
                    <strong data-lang-es="Paso 4:" data-lang-en="Step 4:">Paso 4:</strong> <span data-lang-es="Escribe el s√≠mbolo del activo y ejecuta el backtest" data-lang-en="Enter the asset symbol and run the backtest">Escribe el s√≠mbolo del activo y ejecuta el backtest</span><br>
                    <strong data-lang-es="Paso 5:" data-lang-en="Step 5:">Paso 5:</strong> <span data-lang-es="Los datos se descargan autom√°ticamente desde Binance" data-lang-en="Data is downloaded automatically from Binance">Los datos se descargan autom√°ticamente desde Binance</span><br>
                    <strong data-lang-es="Paso 6:" data-lang-en="Step 6:">Paso 6:</strong> <span data-lang-es="Analiza resultados y optimiza tu estrategia" data-lang-en="Analyze results and optimize your strategy">Analiza resultados y optimiza tu estrategia</span>
                </p>
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong data-lang-es="üöÄ Sin Configuraci√≥n Previa:" data-lang-en="üöÄ No Prior Setup:">üöÄ Sin Configuraci√≥n Previa:</strong> <span class="auto-download-text" data-lang-es="No necesitas descargar datos manualmente, todo es autom√°tico!" data-lang-en="You don't need to download data manually, everything is automatic!">No necesitas descargar datos manualmente, todo es autom√°tico!</span>
                </div>
            </div>

            <h3 style="margin: 25px 0 15px 0; color: #333;" data-lang-es="üìö Ejemplos Pr√°cticos" data-lang-en="üìö Practical Examples">üìö Ejemplos Pr√°cticos</h3>

            <div class="grid-2" style="margin-bottom: 25px;">
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; border-left: 4px solid #2196f3;">
                    <h4 style="margin-top: 0; color: #1976d2;" data-lang-es="üìà Ejemplo 1: Estrategia EMA Simple" data-lang-en="üìà Example 1: Simple EMA Strategy">üìà Ejemplo 1: Estrategia EMA Simple</h4>
                    <p style="line-height: 1.8; margin: 10px 0;">
                        <strong data-lang-es="Entrada LONG:" data-lang-en="LONG Entry:">Entrada LONG:</strong><br>
                        <span data-lang-es='1Ô∏è‚É£ Arrastra "Precio" ‚Üí 2Ô∏è‚É£ "Mayor que (>)" ‚Üí 3Ô∏è‚É£ "EMA" (per√≠odo: 50)' data-lang-en='1Ô∏è‚É£ Drag "Price" ‚Üí 2Ô∏è‚É£ "Greater than (>)" ‚Üí 3Ô∏è‚É£ "EMA" (period: 50)'>1Ô∏è‚É£ Arrastra "Precio" ‚Üí 2Ô∏è‚É£ "Mayor que (>)" ‚Üí 3Ô∏è‚É£ "EMA" (per√≠odo: 50)</span><br>
                        <strong data-lang-es="üí° Significado LONG:" data-lang-en="üí° LONG Meaning:">üí° Significado LONG:</strong> <span data-lang-es="Compra cuando el precio sube por encima de la EMA de 50 per√≠odos (tendencia alcista confirmada)" data-lang-en="Buy when price rises above 50-period EMA (confirmed uptrend)">Compra cuando el precio sube por encima de la EMA de 50 per√≠odos (tendencia alcista confirmada)</span><br><br>
                        <strong data-lang-es="Salida LONG:" data-lang-en="LONG Exit:">Salida LONG:</strong><br>
                        <span data-lang-es='1Ô∏è‚É£ Arrastra "Precio" ‚Üí 2Ô∏è‚É£ "Menor que (<)" ‚Üí 3Ô∏è‚É£ "EMA" (per√≠odo: 50)' data-lang-en='1Ô∏è‚É£ Drag "Price" ‚Üí 2Ô∏è‚É£ "Less than (<)" ‚Üí 3Ô∏è‚É£ "EMA" (period: 50)'>1Ô∏è‚É£ Arrastra "Precio" ‚Üí 2Ô∏è‚É£ "Menor que (<)" ‚Üí 3Ô∏è‚É£ "EMA" (per√≠odo: 50)</span><br>
                        <strong data-lang-es="üí° Significado:" data-lang-en="üí° Meaning:">üí° Significado:</strong> <span data-lang-es="Vende cuando el precio cae por debajo de la EMA (p√©rdida de momentum alcista)" data-lang-en="Sell when price falls below EMA (loss of bullish momentum)">Vende cuando el precio cae por debajo de la EMA (p√©rdida de momentum alcista)</span>
                    </p>
                </div>

                <div style="background: #f3e5f5; padding: 20px; border-radius: 10px; border-left: 4px solid #9c27b0;">
                    <h4 style="margin-top: 0; color: #7b1fa2;" data-lang-es="‚ö° Ejemplo 2: RSI Sobrecompra/Sobreventa" data-lang-en="‚ö° Example 2: RSI Overbought/Oversold">‚ö° Ejemplo 2: RSI Sobrecompra/Sobreventa</h4>
                    <p style="line-height: 1.8; margin: 10px 0;">
                        <strong data-lang-es="Entrada LONG:" data-lang-en="LONG Entry:">Entrada LONG:</strong><br>
                        <span data-lang-es='1Ô∏è‚É£ "RSI" (per√≠odo: 14) ‚Üí 2Ô∏è‚É£ "Menor que (<)" ‚Üí 3Ô∏è‚É£ "N√∫mero" (valor: 30)' data-lang-en='1Ô∏è‚É£ "RSI" (period: 14) ‚Üí 2Ô∏è‚É£ "Less than (<)" ‚Üí 3Ô∏è‚É£ "Number" (value: 30)'>1Ô∏è‚É£ "RSI" (per√≠odo: 14) ‚Üí 2Ô∏è‚É£ "Menor que (<)" ‚Üí 3Ô∏è‚É£ "N√∫mero" (valor: 30)</span><br>
                        <strong data-lang-es="üí° Significado LONG:" data-lang-en="üí° LONG Meaning:">üí° Significado LONG:</strong> <span data-lang-es="Compra en zona de sobreventa cuando el RSI est√° por debajo de 30 (precio muy bajo, probable rebote)" data-lang-en="Buy in oversold zone when RSI is below 30 (very low price, likely bounce)">Compra en zona de sobreventa cuando el RSI est√° por debajo de 30 (precio muy bajo, probable rebote)</span><br><br>
                        <strong data-lang-es="Entrada SHORT:" data-lang-en="SHORT Entry:">Entrada SHORT:</strong><br>
                        <span data-lang-es='1Ô∏è‚É£ "RSI" (per√≠odo: 14) ‚Üí 2Ô∏è‚É£ "Mayor que (>)" ‚Üí 3Ô∏è‚É£ "N√∫mero" (valor: 70)' data-lang-en='1Ô∏è‚É£ "RSI" (period: 14) ‚Üí 2Ô∏è‚É£ "Greater than (>)" ‚Üí 3Ô∏è‚É£ "Number" (value: 70)'>1Ô∏è‚É£ "RSI" (per√≠odo: 14) ‚Üí 2Ô∏è‚É£ "Mayor que (>)" ‚Üí 3Ô∏è‚É£ "N√∫mero" (valor: 70)</span><br>
                        <strong data-lang-es="üí° Significado SHORT:" data-lang-en="üí° SHORT Meaning:">üí° Significado SHORT:</strong> <span data-lang-es="Vende en corto cuando RSI supera 70 (sobrecompra, probable correcci√≥n bajista)" data-lang-en="Sell short when RSI exceeds 70 (overbought, likely bearish correction)">Vende en corto cuando RSI supera 70 (sobrecompra, probable correcci√≥n bajista)</span>
                    </p>
                </div>
            </div>

            <div class="grid-2" style="margin-bottom: 25px;">
                <div style="background: #fff3e0; padding: 20px; border-radius: 10px; border-left: 4px solid #ff9800;">
                    <h4 style="margin-top: 0; color: #f57c00;" data-lang-es="üåä Ejemplo 3: MACD Crossover" data-lang-en="üåä Example 3: MACD Crossover">üåä Ejemplo 3: MACD Crossover</h4>
                    <p style="line-height: 1.8; margin: 10px 0;">
                        <strong data-lang-es="Entrada LONG:" data-lang-en="LONG Entry:">Entrada LONG:</strong><br>
                        <span data-lang-es='1Ô∏è‚É£ "MACD" ‚Üí 2Ô∏è‚É£ "Cruza (‚úñ)" ‚Üí 3Ô∏è‚É£ "Mayor que (>)" ‚Üí 4Ô∏è‚É£ "N√∫mero" (0)' data-lang-en='1Ô∏è‚É£ "MACD" ‚Üí 2Ô∏è‚É£ "Crosses (‚úñ)" ‚Üí 3Ô∏è‚É£ "Greater than (>)" ‚Üí 4Ô∏è‚É£ "Number" (0)'>1Ô∏è‚É£ "MACD" ‚Üí 2Ô∏è‚É£ "Cruza (‚úñ)" ‚Üí 3Ô∏è‚É£ "Mayor que (>)" ‚Üí 4Ô∏è‚É£ "N√∫mero" (0)</span><br>
                        <strong data-lang-es="üí° Significado LONG:" data-lang-en="üí° LONG Meaning:">üí° Significado LONG:</strong> <span data-lang-es="Compra cuando MACD cruza por encima de la l√≠nea de se√±al en territorio positivo (fuerte momentum alcista)" data-lang-en="Buy when MACD crosses above signal line in positive territory (strong bullish momentum)">Compra cuando MACD cruza por encima de la l√≠nea de se√±al en territorio positivo (fuerte momentum alcista)</span><br><br>
                        <strong data-lang-es="Entrada SHORT:" data-lang-en="SHORT Entry:">Entrada SHORT:</strong><br>
                        <span data-lang-es='1Ô∏è‚É£ "MACD" ‚Üí 2Ô∏è‚É£ "Cruza (‚úñ)" ‚Üí 3Ô∏è‚É£ "Menor que (<)" ‚Üí 4Ô∏è‚É£ "N√∫mero" (0)' data-lang-en='1Ô∏è‚É£ "MACD" ‚Üí 2Ô∏è‚É£ "Crosses (‚úñ)" ‚Üí 3Ô∏è‚É£ "Less than (<)" ‚Üí 4Ô∏è‚É£ "Number" (0)'>1Ô∏è‚É£ "MACD" ‚Üí 2Ô∏è‚É£ "Cruza (‚úñ)" ‚Üí 3Ô∏è‚É£ "Menor que (<)" ‚Üí 4Ô∏è‚É£ "N√∫mero" (0)</span><br>
                        <strong data-lang-es="üí° Significado SHORT:" data-lang-en="üí° SHORT Meaning:">üí° Significado SHORT:</strong> <span data-lang-es="Vende en corto cuando MACD cruza por debajo de se√±al en territorio negativo (fuerte momentum bajista)" data-lang-en="Sell short when MACD crosses below signal in negative territory (strong bearish momentum)">Vende en corto cuando MACD cruza por debajo de se√±al en territorio negativo (fuerte momentum bajista)</span>
                    </p>
                </div>

                <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; border-left: 4px solid #4caf50;">
                    <h4 style="margin-top: 0; color: #388e3c;" data-lang-es="üéØ Ejemplo 4: Estrategia Combinada (Avanzado)" data-lang-en="üéØ Example 4: Combined Strategy (Advanced)">üéØ Ejemplo 4: Estrategia Combinada (Avanzado)</h4>
                    <p style="line-height: 1.8; margin: 10px 0;">
                        <strong data-lang-es="Entrada LONG:" data-lang-en="LONG Entry:">Entrada LONG:</strong><br>
                        <span data-lang-es='1Ô∏è‚É£ "Precio" > "EMA(50)" ‚Üí 2Ô∏è‚É£ "AND (‚àß)" ‚Üí 3Ô∏è‚É£ "RSI(14)" > "N√∫mero(50)"' data-lang-en='1Ô∏è‚É£ "Price" > "EMA(50)" ‚Üí 2Ô∏è‚É£ "AND (‚àß)" ‚Üí 3Ô∏è‚É£ "RSI(14)" > "Number(50)"'>1Ô∏è‚É£ "Precio" > "EMA(50)" ‚Üí 2Ô∏è‚É£ "AND (‚àß)" ‚Üí 3Ô∏è‚É£ "RSI(14)" > "N√∫mero(50)"</span><br>
                        <strong data-lang-es="üí° Significado LONG:" data-lang-en="üí° LONG Meaning:">üí° Significado LONG:</strong> <span data-lang-es="Solo compra si AMBAS condiciones se cumplen: precio arriba de EMA Y RSI en zona positiva (confirmaci√≥n doble de tendencia alcista)" data-lang-en="Only buy if BOTH conditions are met: price above EMA AND RSI in positive zone (double confirmation of uptrend)">Solo compra si AMBAS condiciones se cumplen: precio arriba de EMA Y RSI en zona positiva (confirmaci√≥n doble de tendencia alcista)</span><br><br>
                        <strong data-lang-es="Entrada SHORT:" data-lang-en="SHORT Entry:">Entrada SHORT:</strong><br>
                        <span data-lang-es='1Ô∏è‚É£ "Precio" < "EMA(50)" ‚Üí 2Ô∏è‚É£ "AND (‚àß)" ‚Üí 3Ô∏è‚É£ "RSI(14)" < "N√∫mero(50)"' data-lang-en='1Ô∏è‚É£ "Price" < "EMA(50)" ‚Üí 2Ô∏è‚É£ "AND (‚àß)" ‚Üí 3Ô∏è‚É£ "RSI(14)" < "Number(50)"'>1Ô∏è‚É£ "Precio" < "EMA(50)" ‚Üí 2Ô∏è‚É£ "AND (‚àß)" ‚Üí 3Ô∏è‚É£ "RSI(14)" < "N√∫mero(50)"</span><br>
                        <strong data-lang-es="üí° Significado SHORT:" data-lang-en="üí° SHORT Meaning:">üí° Significado SHORT:</strong> <span data-lang-es="Solo vende en corto si AMBAS condiciones se cumplen: precio debajo de EMA Y RSI en zona negativa (confirmaci√≥n doble de tendencia bajista)" data-lang-en="Only sell short if BOTH conditions are met: price below EMA AND RSI in negative zone (double confirmation of downtrend)">Solo vende en corto si AMBAS condiciones se cumplen: precio debajo de EMA Y RSI en zona negativa (confirmaci√≥n doble de tendencia bajista)</span><br><br>
                        <strong data-lang-es="Salida LONG:" data-lang-en="LONG Exit:">Salida LONG:</strong> <span data-lang-es='"RSI(14)" > "N√∫mero(70)" (Sobrecompra)' data-lang-en='"RSI(14)" > "Number(70)" (Overbought)'>"RSI(14)" > "N√∫mero(70)" (Sobrecompra)</span><br>
                        <strong data-lang-es="Salida SHORT:" data-lang-en="SHORT Exit:">Salida SHORT:</strong> <span data-lang-es='"RSI(14)" < "N√∫mero(30)" (Sobreventa)' data-lang-en='"RSI(14)" < "Number(30)" (Oversold)'>"RSI(14)" < "N√∫mero(30)" (Sobreventa)</span>
                    </p>
                </div>
            </div>

            <div class="grid-2">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h4 style="margin-top: 0;" data-lang-es="üì¶ Indicadores Disponibles" data-lang-en="üì¶ Available Indicators">üì¶ Indicadores Disponibles</h4>
                    <ul style="line-height: 2; margin: 10px 0;">
                        <li data-lang-es="EMA/SMA: Medias m√≥viles exponencial y simple" data-lang-en="EMA/SMA: Exponential and simple moving averages"><strong>EMA/SMA:</strong> Medias m√≥viles exponencial y simple</li>
                        <li data-lang-es="RSI: √çndice de Fuerza Relativa (sobrecompra/sobreventa)" data-lang-en="RSI: Relative Strength Index (overbought/oversold)"><strong>RSI:</strong> √çndice de Fuerza Relativa (sobrecompra/sobreventa)</li>
                        <li data-lang-es="MACD: Convergencia/Divergencia (momentum)" data-lang-en="MACD: Convergence/Divergence (momentum)"><strong>MACD:</strong> Convergencia/Divergencia (momentum)</li>
                        <li data-lang-es="Bollinger: Bandas de volatilidad superior/media/inferior" data-lang-en="Bollinger: Upper/middle/lower volatility bands"><strong>Bollinger:</strong> Bandas de volatilidad superior/media/inferior</li>
                        <li data-lang-es="ATR: Average True Range (volatilidad)" data-lang-en="ATR: Average True Range (volatility)"><strong>ATR:</strong> Average True Range (volatilidad)</li>
                        <li data-lang-es="Swing: M√°ximos/M√≠nimos locales" data-lang-en="Swing: Local highs/lows"><strong>Swing:</strong> M√°ximos/M√≠nimos locales</li>
                    </ul>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h4 style="margin-top: 0;" data-lang-es="‚ö° Operadores & L√≥gica" data-lang-en="‚ö° Operators & Logic">‚ö° Operadores & L√≥gica</h4>
                    <ul style="line-height: 2; margin: 10px 0;">
                        <li data-lang-es="> Mayor que: Precio > EMA" data-lang-en="> Greater than: Price > EMA"><strong>> Mayor que:</strong> Precio > EMA</li>
                        <li data-lang-es="< Menor que: RSI < 30" data-lang-en="< Less than: RSI < 30"><strong>< Menor que:</strong> RSI < 30</li>
                        <li data-lang-es="‚â• ‚â§ = ‚â† Otras comparaciones" data-lang-en="‚â• ‚â§ = ‚â† Other comparisons"><strong>‚â• ‚â§ = ‚â†</strong> Otras comparaciones</li>
                        <li data-lang-es="‚úñ Cruza: Detecta cuando una l√≠nea cruza otra" data-lang-en="‚úñ Crosses: Detects when one line crosses another"><strong>‚úñ Cruza:</strong> Detecta cuando una l√≠nea cruza otra</li>
                        <li data-lang-es="AND (‚àß): Ambas condiciones deben cumplirse" data-lang-en="AND (‚àß): Both conditions must be met"><strong>AND (‚àß):</strong> Ambas condiciones deben cumplirse</li>
                        <li data-lang-es="OR (‚à®): Al menos una condici√≥n" data-lang-en="OR (‚à®): At least one condition"><strong>OR (‚à®):</strong> Al menos una condici√≥n</li>
                        <li data-lang-es="NOT/XOR/NAND/NOR: L√≥gica avanzada" data-lang-en="NOT/XOR/NAND/NOR: Advanced logic"><strong>NOT/XOR/NAND/NOR:</strong> L√≥gica avanzada</li>
                    </ul>
                </div>
            </div>

            <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; margin-top: 25px; border-radius: 5px;">
                <h4 style="margin-top: 0; color: #f57f17;" data-lang-es="‚ö†Ô∏è Importante - Configurar Estrategia" data-lang-en="‚ö†Ô∏è Important - Configure Strategy">‚ö†Ô∏è Importante - Configurar Estrategia</h4>
                <p style="margin: 10px 0; line-height: 1.8;">
                    <span data-lang-es="DEBES configurar al menos 1 condici√≥n en 'Entrada LONG' o 'Entrada SHORT' antes de ejecutar el backtest. Si no arrastras ning√∫n bloque, el sistema mostrar√° un error al intentar ejecutar." data-lang-en="You MUST configure at least 1 condition in 'LONG Entry' or 'SHORT Entry' before running the backtest. If you don't drag any blocks, the system will show an error when trying to execute."><strong>DEBES configurar al menos 1 condici√≥n</strong> en "Entrada LONG" o "Entrada SHORT" antes de ejecutar el backtest.<br>
                    Si no arrastras ning√∫n bloque, el sistema mostrar√° un error al intentar ejecutar.</span>
                </p>
            </div>
        </div>

        <!-- SECCI√ìN 2: CONSTRUCTOR VISUAL -->
        <div class="section">
            <div class="section-header">
                <span class="section-icon">üé®</span>
                <h2 data-lang-es="2. Constructor Visual de Estrategia" data-lang-en="2. Visual Strategy Builder">2. Constructor Visual de Estrategia</h2>
            </div>

            <p class="info-text" style="margin-bottom: 20px;" data-lang-es="Arrastra y suelta bloques para construir tu estrategia de trading de forma visual." data-lang-en="Drag and drop blocks to build your trading strategy visually.">
                Arrastra y suelta bloques para construir tu estrategia de trading de forma visual.
            </p>

            <div class="strategy-builder">
                <!-- Paleta de bloques REORGANIZADA EN GRID HORIZONTAL -->
                <div class="blocks-palette">
                    <!-- Secci√≥n Indicadores -->
                    <div class="palette-section">
                        <div class="palette-title" data-lang-es="üìä Indicadores" data-lang-en="üìä Indicators">üìä Indicadores</div>
                        <div class="block indicator" draggable="true" data-type="indicator" data-name="EMA" title="Media M√≥vil Exponencial">
                            <span class="block-icon">üìà</span> EMA<br><small>Media Exp.</small>
                        </div>
                        <div class="block indicator" draggable="true" data-type="indicator" data-name="SMA" title="Media M√≥vil Simple">
                            <span class="block-icon">üìâ</span> SMA<br><small>Media Simple</small>
                        </div>
                        <div class="block indicator" draggable="true" data-type="indicator" data-name="RSI" title="√çndice de Fuerza Relativa">
                            <span class="block-icon">‚ö°</span> RSI<br><small>Fuerza</small>
                        </div>
                        <div class="block indicator" draggable="true" data-type="indicator" data-name="MACD" title="MACD">
                            <span class="block-icon">üåä</span> MACD<br><small>Momentum</small>
                        </div>
                    </div>
                    
                    <!-- Secci√≥n M√°s Indicadores -->
                    <div class="palette-section">
                        <div class="palette-title" data-lang-es="üìê M√°s Indicadores" data-lang-en="üìê More Indicators">üìê M√°s Indicadores</div>
                        <div class="block indicator" draggable="true" data-type="indicator" data-name="BBands" title="Bandas de Bollinger">
                            <span class="block-icon">üìè</span> Bollinger<br><small>Volatilidad</small>
                        </div>
                        <div class="block indicator" draggable="true" data-type="indicator" data-name="ATR" title="Average True Range">
                            <span class="block-icon">üìä</span> ATR<br><small>Rango</small>
                        </div>
                        <div class="block indicator" draggable="true" data-type="indicator" data-name="Swing" title="Swing High/Low">
                            <span class="block-icon">üîÑ</span> Swing<br><small>M√°x/M√≠n</small>
                        </div>
                    </div>
                    
                    <!-- Secci√≥n Valores -->
                    <div class="palette-section">
                        <div class="palette-title" data-lang-es="üí∞ Valores" data-lang-en="üí∞ Values">üí∞ Valores</div>
                        <div class="block value" draggable="true" data-type="value" data-name="Price" title="Precio actual">
                            <span class="block-icon">üíµ</span> Precio<br><small>Actual</small>
                        </div>
                        <div class="block value" draggable="true" data-type="value" data-name="Number" title="N√∫mero fijo">
                            <span class="block-icon">üî¢</span> N√∫mero<br><small>Fijo</small>
                        </div>
                        <div class="block value" draggable="true" data-type="value" data-name="Percentage" title="Porcentaje">
                            <span class="block-icon">%</span> Porcentaje<br><small>%</small>
                        </div>
                    </div>
                    
                    <!-- Secci√≥n Operadores -->
                    <div class="palette-section">
                        <div class="palette-title" data-lang-es="‚ö° Comparadores" data-lang-en="‚ö° Comparators">‚ö° Comparadores</div>
                        <div class="block operator" draggable="true" data-type="operator" data-name="GreaterThan" title="Mayor que">
                            <span class="block-icon">></span> Mayor<br><small>A > B</small>
                        </div>
                        <div class="block operator" draggable="true" data-type="operator" data-name="LessThan" title="Menor que">
                            <span class="block-icon"><</span> Menor<br><small>A < B</small>
                        </div>
                        <div class="block operator" draggable="true" data-type="operator" data-name="GreaterOrEqual" title="Mayor o igual">
                            <span class="block-icon">‚â•</span> Mayor/Igual<br><small>A ‚â• B</small>
                        </div>
                        <div class="block operator" draggable="true" data-type="operator" data-name="LessOrEqual" title="Menor o igual">
                            <span class="block-icon">‚â§</span> Menor/Igual<br><small>A ‚â§ B</small>
                        </div>
                        <div class="block operator" draggable="true" data-type="operator" data-name="Equal" title="Igual">
                            <span class="block-icon">=</span> Igual<br><small>A = B</small>
                        </div>
                        <div class="block operator" draggable="true" data-type="operator" data-name="NotEqual" title="Diferente">
                            <span class="block-icon">‚â†</span> Diferente<br><small>A ‚â† B</small>
                        </div>
                        <div class="block operator" draggable="true" data-type="operator" data-name="Crosses" title="Cruza">
                            <span class="block-icon">‚úñ</span> Cruza<br><small>Crossover</small>
                        </div>
                    </div>
                    
                    <!-- Secci√≥n L√≥gica -->
                    <div class="palette-section">
                        <div class="palette-title" data-lang-es="üéØ L√≥gica" data-lang-en="üéØ Logic">üéØ L√≥gica</div>
                        <div class="block condition" draggable="true" data-type="condition" data-name="AND" title="Y l√≥gico">
                            <span class="block-icon">‚àß</span> AND<br><small>A y B</small>
                        </div>
                        <div class="block condition" draggable="true" data-type="condition" data-name="OR" title="O l√≥gico">
                            <span class="block-icon">‚à®</span> OR<br><small>A o B</small>
                        </div>
                        <div class="block condition" draggable="true" data-type="condition" data-name="NOT" title="Negaci√≥n">
                            <span class="block-icon">¬¨</span> NOT<br><small>Niega</small>
                        </div>
                        <div class="block condition" draggable="true" data-type="condition" data-name="XOR" title="O exclusivo">
                            <span class="block-icon">‚äï</span> XOR<br><small>Solo uno</small>
                        </div>
                        <div class="block condition" draggable="true" data-type="condition" data-name="NAND" title="NAND">
                            <span class="block-icon">‚äº</span> NAND<br><small>NO ambos</small>
                        </div>
                        <div class="block condition" draggable="true" data-type="condition" data-name="NOR" title="NOR">
                            <span class="block-icon">‚äΩ</span> NOR<br><small>Ninguno</small>
                        </div>
                    </div>
                </div>

                <!-- Canvas de construcci√≥n -->
                <div class="builder-canvas">
                    <!-- Zona de entrada LONG -->
                    <div class="drop-zone" id="entry_long_zone" data-zone="entry_long">
                        <div class="drop-zone-title">
                            <span>üìà</span>
                            <span data-lang-es="Condiciones de Entrada LONG" data-lang-en="LONG Entry Conditions">Condiciones de Entrada LONG</span>
                        </div>
                        <div class="drop-zone-content">
                            <div class="drop-zone-empty" data-lang-es="Arrastra bloques aqu√≠ para definir cu√°ndo entrar en posici√≥n LONG" data-lang-en="Drag blocks here to define when to enter LONG position">
                                Arrastra bloques aqu√≠ para definir cu√°ndo entrar en posici√≥n LONG
                            </div>
                        </div>
                    </div>

                    <!-- Zona de salida LONG -->
                    <div class="drop-zone" id="exit_long_zone" data-zone="exit_long">
                        <div class="drop-zone-title">
                            <span>üö™</span>
                            <span data-lang-es="Condiciones de Salida LONG" data-lang-en="LONG Exit Conditions">Condiciones de Salida LONG</span>
                        </div>
                        <div class="drop-zone-content">
                            <div class="drop-zone-empty" data-lang-es="Arrastra bloques aqu√≠ para definir cu√°ndo salir de posici√≥n LONG" data-lang-en="Drag blocks here to define when to exit LONG position">
                                Arrastra bloques aqu√≠ para definir cu√°ndo salir de posici√≥n LONG
                            </div>
                        </div>
                    </div>

                    <!-- Zona de entrada SHORT -->
                    <div class="drop-zone" id="entry_short_zone" data-zone="entry_short">
                        <div class="drop-zone-title">
                            <span>üìâ</span>
                            <span data-lang-es="Condiciones de Entrada SHORT" data-lang-en="SHORT Entry Conditions">Condiciones de Entrada SHORT</span>
                        </div>
                        <div class="drop-zone-content">
                            <div class="drop-zone-empty" data-lang-es="Arrastra bloques aqu√≠ para definir cu√°ndo entrar en posici√≥n SHORT" data-lang-en="Drag blocks here to define when to enter SHORT position">
                                Arrastra bloques aqu√≠ para definir cu√°ndo entrar en posici√≥n SHORT
                            </div>
                        </div>
                    </div>

                    <!-- Zona de salida SHORT -->
                    <div class="drop-zone" id="exit_short_zone" data-zone="exit_short">
                        <div class="drop-zone-title">
                            <span>üö™</span>
                            <span data-lang-es="Condiciones de Salida SHORT" data-lang-en="SHORT Exit Conditions">Condiciones de Salida SHORT</span>
                        </div>
                        <div class="drop-zone-content">
                            <div class="drop-zone-empty" data-lang-es="Arrastra bloques aqu√≠ para definir cu√°ndo salir de posici√≥n SHORT" data-lang-en="Drag blocks here to define when to exit SHORT position">
                                Arrastra bloques aqu√≠ para definir cu√°ndo salir de posici√≥n SHORT
                            </div>
                        </div>
                    </div>

                    <!-- Acciones -->
                    <div class="strategy-actions">
                        <button class="btn btn-secondary" onclick="clearStrategy()" data-lang-es="üóëÔ∏è Limpiar Todo" data-lang-en="üóëÔ∏è Clear All">üóëÔ∏è Limpiar Todo</button>
                        <button class="btn btn-secondary" onclick="exportStrategy()" data-lang-es="üì• Exportar Estrategia" data-lang-en="üì• Export Strategy">üì• Exportar Estrategia</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()" data-lang-es="üì§ Importar Estrategia" data-lang-en="üì§ Import Strategy">üì§ Importar Estrategia</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importStrategy(event)">
                    </div>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 3: ADMINISTRACI√ìN DE BOTS -->
        <div class="section">
            <div class="section-header">
                <span class="section-icon">ü§ñ</span>
                <h2 data-lang-es="3. Mis Bots de Se√±ales" data-lang-en="3. My Signal Bots">3. Mis Bots de Se√±ales</h2>
            </div>

            <p class="info-text" style="margin-bottom: 20px; background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #2196f3;">
                <strong data-lang-es="ü§ñ Gesti√≥n de Bots:" data-lang-en="ü§ñ Bot Management:">ü§ñ Gesti√≥n de Bots:</strong> <span data-lang-es="Crea, pausa, activa y administra m√∫ltiples bots de se√±ales con diferentes estrategias." data-lang-en="Create, pause, activate and manage multiple signal bots with different strategies.">Crea, pausa, activa y administra m√∫ltiples bots de se√±ales con diferentes estrategias.</span>
            </p>

            <!-- Bot√≥n para crear nuevo bot -->
            <div style="margin-bottom: 30px; text-align: center;">
                <button onclick="showCreateBotModal()" class="btn" style="max-width: 400px; margin: 0 auto;">
                    <span data-lang-es="‚ûï Crear Nuevo Bot" data-lang-en="‚ûï Create New Bot">‚ûï Crear Nuevo Bot</span>
                </button>
            </div>

            <!-- Lista de Bots Creados -->
            <div id="bots_list" style="margin-top: 20px;">
                <div style="text-align: center; padding: 40px; color: #999;">
                    <p style="font-size: 1.2em;" data-lang-es="üìã No tienes bots creados a√∫n" data-lang-en="üìã You don't have any bots yet">üìã No tienes bots creados a√∫n</p>
                    <p style="font-size: 0.9em; margin-top: 10px;" data-lang-es="Crea tu primer bot con la estrategia que dise√±aste arriba" data-lang-en="Create your first bot with the strategy you designed above">Crea tu primer bot con la estrategia que dise√±aste arriba</p>
                </div>
            </div>
        </div>

        <!-- MODAL PARA CREAR/EDITAR BOT -->
        <div id="createBotModal" class="disclaimer-modal" style="display: none;">
            <div class="disclaimer-content" id="createBotModalContent" style="max-width: 700px;">
                <div class="disclaimer-header">
                    <span style="font-size: 2em;">ü§ñ</span>
                    <h2 id="modalTitle" data-lang-es="Crear Nuevo Bot" data-lang-en="Create New Bot">Crear Nuevo Bot</h2>
                </div>

                <form id="createBotForm" onsubmit="saveBotConfig(event)">
                    <input type="hidden" id="edit_bot_id" value="">
                    
                    <!-- Traductor de Estrategia -->
                    <div id="strategy_translator_section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; margin-bottom: 25px; color: white;">
                        <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px; color: white;">
                            <span>üéØ</span>
                            <span data-lang-es="Tu Estrategia en Lenguaje Humano" data-lang-en="Your Strategy in Human Language">Tu Estrategia en Lenguaje Humano</span>
                        </h4>
                        <div id="strategy_human_readable" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px; backdrop-filter: blur(10px); line-height: 1.8; white-space: pre-line;">
                            <p style="margin: 0; color: rgba(255,255,255,0.8); font-style: italic;" data-lang-es="Cargando estrategia..." data-lang-en="Loading strategy...">Cargando estrategia...</p>
                        </div>
                        <small style="display: block; margin-top: 10px; color: rgba(255,255,255,0.8);" data-lang-es="‚ö° Esta es la traducci√≥n de los bloques que has configurado" data-lang-en="‚ö° This is the translation of the blocks you configured">‚ö° Esta es la traducci√≥n de los bloques que has configurado</small>
                    </div>
                    
                    <!-- Nombre del Bot -->
                    <div class="form-group">
                        <label for="bot_name">
                            <span data-lang-es="üìù Nombre del Bot" data-lang-en="üìù Bot Name">üìù Nombre del Bot</span>
                        </label>
                        <input type="text" id="bot_name" required 
                               data-placeholder-es="Ej: Bot RSI BTCUSDT" 
                               data-placeholder-en="Ex: RSI Bot BTCUSDT"
                               placeholder="Ej: Bot RSI BTCUSDT">
                        <small data-lang-es="Ponle un nombre descriptivo para identificarlo f√°cilmente" 
                               data-lang-en="Give it a descriptive name to identify it easily">Ponle un nombre descriptivo para identificarlo f√°cilmente</small>
                    </div>

                    <!-- Configuraci√≥n de Telegram -->
                    <div style="background: #f3e5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px;">üì± Configuraci√≥n de Telegram</h4>
                        
                        <div class="form-group">
                            <label for="modal_bot_token">
                                <span data-lang-es="üîë Bot Token" data-lang-en="üîë Bot Token">üîë Bot Token</span>
                            </label>
                            <div style="display: flex; gap: 10px;">
                                <input type="password" id="modal_bot_token" required 
                                       placeholder="123456:ABC-DEF..." style="flex: 1;">
                                <button type="button" onclick="toggleModalTokenVisibility()" 
                                        class="btn-secondary" style="width: auto; padding: 10px 15px;">
                                    üëÅÔ∏è
                                </button>
                            </div>
                            <small>
                                <span data-lang-es="Obt√©n tu token de" data-lang-en="Get your token from">Obt√©n tu token de</span> 
                                <a href="https://t.me/BotFather" target="_blank" style="color: #667eea; font-weight: 600;">@BotFather</a>
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="modal_chat_id">
                                <span data-lang-es="üí¨ Chat ID" data-lang-en="üí¨ Chat ID">üí¨ Chat ID</span>
                            </label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="modal_chat_id" required 
                                       placeholder="123456789" style="flex: 1;">
                                <button type="button" onclick="getModalChatId()" 
                                        class="btn-secondary" style="width: auto; padding: 10px 20px;">
                                    <span data-lang-es="Obtener" data-lang-en="Get">Obtener</span>
                                </button>
                            </div>
                            <small>
                                <span data-lang-es="Escribe algo a tu bot y haz clic en 'Obtener'" 
                                      data-lang-en="Send a message to your bot and click 'Get'">Escribe algo a tu bot y haz clic en 'Obtener'</span>
                            </small>
                        </div>

                        <button type="button" onclick="sendModalTestMessage()" class="btn-secondary" style="width: 100%;">
                            <span data-lang-es="üß™ Enviar Mensaje de Prueba" data-lang-en="üß™ Send Test Message">üß™ Enviar Mensaje de Prueba</span>
                        </button>
                    </div>

                    <!-- Configuraci√≥n de Trading -->
                    <div style="background: #e7f3ff; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px;">üìä Configuraci√≥n de Trading</h4>
                        
                        <!-- Campo para escribir el s√≠mbolo del activo -->
                        <div class="form-group">
                            <label for="modal_asset_symbol">
                                <span data-lang-es="ü™ô S√≠mbolo del Activo" data-lang-en="ü™ô Asset Symbol">ü™ô S√≠mbolo del Activo</span>
                            </label>
                            <input type="text" id="modal_asset_symbol" required 
                                   data-placeholder-es="Ej: BTC, ETH, SOL, DOGE..." 
                                   data-placeholder-en="Ex: BTC, ETH, SOL, DOGE..."
                                   placeholder="Ej: BTC, ETH, SOL, DOGE..."
                                   style="text-transform: uppercase; font-size: 16px; font-weight: 600;" 
                                   oninput="this.value = this.value.toUpperCase(); updateFullSymbol()">
                            <small data-lang-es="Escribe el s√≠mbolo del activo que deseas operar" 
                                   data-lang-en="Enter the asset symbol you want to trade">Escribe el s√≠mbolo del activo que deseas operar</small>
                        </div>

                        <!-- Selector del par de cotizaci√≥n -->
                        <div class="form-group">
                            <label for="modal_quote_asset">
                                <span data-lang-es="üí± Par de Cotizaci√≥n" data-lang-en="üí± Quote Asset">üí± Par de Cotizaci√≥n</span>
                            </label>
                            <select id="modal_quote_asset" required onchange="updateFullSymbol()">
                                <option value="USDT" selected>USDT (Tether)</option>
                                <option value="BUSD">BUSD (Binance USD)</option>
                                <option value="USDC">USDC (USD Coin)</option>
                                <option value="USD">USD (D√≥lar)</option>
                                <option value="EUR">EUR (Euro)</option>
                                <option value="BTC">BTC (Bitcoin)</option>
                                <option value="ETH">ETH (Ethereum)</option>
                                <option value="BNB">BNB (Binance Coin)</option>
                            </select>
                            <small data-lang-es="Selecciona contra qu√© activo quieres cotizar" 
                                   data-lang-en="Select which asset to quote against">Selecciona contra qu√© activo quieres cotizar</small>
                        </div>

                        <!-- Preview del s√≠mbolo completo -->
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #667eea; margin-bottom: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.3em;">üìä</span>
                                <div>
                                    <strong style="color: #667eea;" data-lang-es="S√≠mbolo Completo:" data-lang-en="Full Symbol:">S√≠mbolo Completo:</strong>
                                    <p id="full_symbol_preview" style="margin: 5px 0 0 0; font-size: 1.4em; font-weight: bold; color: #333;">-</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hidden input que contendr√° el s√≠mbolo completo -->
                        <input type="hidden" id="modal_symbol">

                        <div class="form-group">
                            <label for="modal_timeframe">
                                <span data-lang-es="‚è±Ô∏è Intervalo de Tiempo" data-lang-en="‚è±Ô∏è Timeframe">‚è±Ô∏è Intervalo de Tiempo</span>
                            </label>
                            <select id="modal_timeframe" required>
                                <option value="1m" data-lang-es="1 minuto" data-lang-en="1 minute">1 minuto</option>
                                <option value="5m" data-lang-es="5 minutos" data-lang-en="5 minutes">5 minutos</option>
                                <option value="15m" data-lang-es="15 minutos" data-lang-en="15 minutes" selected>15 minutos</option>
                                <option value="1h" data-lang-es="1 hora" data-lang-en="1 hour">1 hora</option>
                                <option value="4h" data-lang-es="4 horas" data-lang-en="4 hours">4 horas</option>
                                <option value="1d" data-lang-es="1 d√≠a" data-lang-en="1 day">1 d√≠a</option>
                            </select>
                            <small data-lang-es="El bot verificar√° se√±ales al cierre de cada vela de este intervalo" 
                                   data-lang-en="Bot will check for signals at the close of each candle">El bot verificar√° se√±ales al cierre de cada vela de este intervalo</small>
                        </div>
                    </div>

                    <!-- Botones del modal -->
                    <div class="disclaimer-buttons">
                        <button type="button" onclick="closeBotModal()" class="disclaimer-btn disclaimer-btn-cancel">
                            <span data-lang-es="Cancelar" data-lang-en="Cancel">Cancelar</span>
                        </button>
                        <button type="submit" class="disclaimer-btn disclaimer-btn-accept">
                            <span data-lang-es="üíæ Guardar Bot" data-lang-en="üíæ Save Bot">üíæ Guardar Bot</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <script>
        // ==================== STRATEGY BUILDER ====================
        
        let strategyConfig = {
            entry_long: [],
            exit_long: [],
            entry_short: [],
            exit_short: []
        };

        let blockCounter = 0;

        // Configuraci√≥n del drag and drop
        document.addEventListener('DOMContentLoaded', function() {
            initStrategyBuilder();
            updateStrategyInfo();
        });

        function initStrategyBuilder() {
            // Hacer bloques arrastrables
            const blocks = document.querySelectorAll('.block[draggable="true"]');
            blocks.forEach(block => {
                block.addEventListener('dragstart', handleDragStart);
                block.addEventListener('dragend', handleDragEnd);
            });

            // Configurar zonas de drop
            const dropZones = document.querySelectorAll('.drop-zone');
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function updateStrategyInfo() {
            const infoElement = document.getElementById('strategy_info');
            
            // Elemento opcional - Si no existe, simplemente salir sin warning
            if (!infoElement) {
                return;
            }
            
            const totalBlocks = document.querySelectorAll('.dropped-block').length;
            const lang = localStorage.getItem('language') || 'en';
            
            if (totalBlocks === 0) {
                infoElement.innerHTML = lang === 'es' 
                    ? '‚ùå No configurada - Arrastra bloques en Secci√≥n 2'
                    : '‚ùå Not configured - Drag blocks in Section 2';
                infoElement.style.color = '#ff6b6b';
            } else {
                const zones = {
                    entry_long: document.querySelectorAll('[data-zone="entry_long"] .dropped-block').length,
                    exit_long: document.querySelectorAll('[data-zone="exit_long"] .dropped-block').length,
                    entry_short: document.querySelectorAll('[data-zone="entry_short"] .dropped-block').length,
                    exit_short: document.querySelectorAll('[data-zone="exit_short"] .dropped-block').length
                };
                
                // Traducir estrategia a lenguaje humano
                const strategyText = translateStrategyToHuman(lang);
                
                if (lang === 'es') {
                    infoElement.innerHTML = `
                        ‚úÖ Configurada con ${totalBlocks} bloques<br>
                        <small style="opacity: 0.8;">
                            Entrada LONG: ${zones.entry_long} | Salida LONG: ${zones.exit_long}<br>
                            Entrada SHORT: ${zones.entry_short} | Salida SHORT: ${zones.exit_short}
                        </small>
                        ${strategyText ? '<br><br>' + strategyText : ''}
                    `;
                } else {
                    infoElement.innerHTML = `
                        ‚úÖ Configured with ${totalBlocks} blocks<br>
                        <small style="opacity: 0.8;">
                            LONG Entry: ${zones.entry_long} | LONG Exit: ${zones.exit_long}<br>
                            SHORT Entry: ${zones.entry_short} | SHORT Exit: ${zones.exit_short}
                        </small>
                        ${strategyText ? '<br><br>' + strategyText : ''}
                    `;
                }
                infoElement.style.color = '#4caf50';
            }
        }
        
        function translateStrategyToHuman(lang) {
            const zones = [
                { id: 'entry_long_zone', label: lang === 'es' ? 'üìà Entrada LONG' : 'üìà LONG Entry' },
                { id: 'exit_long_zone', label: lang === 'es' ? 'üö™ Salida LONG' : 'üö™ LONG Exit' },
                { id: 'entry_short_zone', label: lang === 'es' ? 'üìâ Entrada SHORT' : 'üìâ SHORT Entry' },
                { id: 'exit_short_zone', label: lang === 'es' ? 'üîö Salida SHORT' : 'üîö SHORT Exit' }
            ];
            
            let html = '<div style="margin-top: 10px; padding: 10px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); border-radius: 6px; border-left: 3px solid #667eea;">';
            html += `<strong style="color: #764ba2;">${lang === 'es' ? 'üîç Traducci√≥n de Estrategia:' : 'üîç Strategy Translation:'}</strong><br>`;
            
            let hasConditions = false;
            zones.forEach(zone => {
                const zoneElement = document.getElementById(zone.id);
                if (!zoneElement) return;
                
                const blocks = zoneElement.querySelectorAll('.dropped-block');
                if (blocks.length === 0) return;
                
                hasConditions = true;
                html += `<br><strong style="color: #667eea;">${zone.label}:</strong><br>`;
                
                blocks.forEach((block, index) => {
                    const blockName = block.dataset.name;
                    const blockType = block.dataset.type;
                    const description = getBlockDescription(blockName, blockType, block, lang);
                    html += `${index + 1}. ${description}<br>`;
                });
            });
            
            html += '</div>';
            return hasConditions ? html : '';
        }
        
        function getBlockDescription(name, type, blockElement, lang) {
            const translations = {
                es: {
                    EMA: 'Media M√≥vil Exponencial',
                    SMA: 'Media M√≥vil Simple',
                    RSI: '√çndice de Fuerza Relativa',
                    MACD: 'MACD (Convergencia/Divergencia)',
                    BBands: 'Bandas de Bollinger',
                    ATR: 'Rango Verdadero Promedio',
                    Swing: 'Swing High/Low',
                    Price: 'Precio actual',
                    Number: 'N√∫mero',
                    Percentage: 'Porcentaje',
                    GreaterThan: 'Mayor que',
                    LessThan: 'Menor que',
                    GreaterOrEqual: 'Mayor o igual que',
                    LessOrEqual: 'Menor o igual que',
                    Equal: 'Igual a',
                    NotEqual: 'Diferente de',
                    Crosses: 'Cruza',
                    AND: 'Y (ambas condiciones)',
                    OR: 'O (cualquiera)',
                    NOT: 'NO (niega condici√≥n)',
                    XOR: 'XOR (solo una)',
                    NAND: 'NAND (no ambas)',
                    NOR: 'NOR (ninguna)'
                },
                en: {
                    EMA: 'Exponential Moving Average',
                    SMA: 'Simple Moving Average',
                    RSI: 'Relative Strength Index',
                    MACD: 'MACD (Convergence/Divergence)',
                    BBands: 'Bollinger Bands',
                    ATR: 'Average True Range',
                    Swing: 'Swing High/Low',
                    Price: 'Current price',
                    Number: 'Number',
                    Percentage: 'Percentage',
                    GreaterThan: 'Greater than',
                    LessThan: 'Less than',
                    GreaterOrEqual: 'Greater or equal to',
                    LessOrEqual: 'Less or equal to',
                    Equal: 'Equal to',
                    NotEqual: 'Different from',
                    Crosses: 'Crosses',
                    AND: 'AND (both conditions)',
                    OR: 'OR (any condition)',
                    NOT: 'NOT (negates condition)',
                    XOR: 'XOR (only one)',
                    NAND: 'NAND (not both)',
                    NOR: 'NOR (neither)'
                }
            };
            
            const dict = translations[lang];
            let desc = dict[name] || name;
            
            // Agregar par√°metros si existen
            const inputs = blockElement.querySelectorAll('input, select');
            if (inputs.length > 0) {
                const params = [];
                inputs.forEach(input => {
                    if (input.value) {
                        params.push(input.value);
                    }
                });
                if (params.length > 0) {
                    desc += ` (${params.join(', ')})`;
                }
            }
            
            return desc;
        }

        function handleDragStart(e) {
            e.dataTransfer.effectAllowed = 'copy';
            e.dataTransfer.setData('text/plain', JSON.stringify({
                type: this.dataset.type,
                name: this.dataset.name,
                html: this.outerHTML
            }));
            
            // Ocultar paleta despu√©s de un peque√±o delay
            setTimeout(() => {
                document.querySelector('.blocks-palette').classList.add('dragging');
                document.querySelector('.builder-canvas').classList.add('dragging-active');
                
                // Hacer scroll al canvas para que las cajas sean visibles
                const canvas = document.querySelector('.builder-canvas');
                if (canvas) {
                    canvas.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 50);
        }
        
        function handleDragEnd(e) {
            // Mostrar paleta nuevamente
            document.querySelector('.blocks-palette').classList.remove('dragging');
            document.querySelector('.builder-canvas').classList.remove('dragging-active');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
            const zone = this.dataset.zone;
            
            addBlockToZone(zone, data);
        }

        function addBlockToZone(zone, blockData) {
            const zoneElement = document.querySelector(`[data-zone="${zone}"]`);
            if (!zoneElement) {
                console.error(`Zone element not found for: ${zone}`);
                return;
            }
            
            const contentElement = zoneElement.querySelector('.drop-zone-content');
            if (!contentElement) {
                console.error(`Content element not found in zone: ${zone}`);
                return;
            }
            
            // Remover mensaje vac√≠o
            const emptyMsg = contentElement.querySelector('.drop-zone-empty');
            if (emptyMsg) {
                emptyMsg.remove();
            }
            
            const blockId = `block_${blockCounter++}`;
            
            // Crear el bloque dropped
            const droppedBlock = document.createElement('div');
            droppedBlock.className = 'dropped-block';
            droppedBlock.dataset.blockId = blockId;
            droppedBlock.dataset.type = blockData.type;
            droppedBlock.dataset.name = blockData.name;
            
            let paramsHtml = '';
            
            // Generar inputs seg√∫n el tipo de bloque
            if (blockData.name === 'EMA' || blockData.name === 'SMA') {
                paramsHtml = `
                    <div class="block-params">
                        <div class="param-group">
                            <label>Per√≠odo</label>
                            <input type="number" id="${blockId}_period" value="50" min="1" max="200" step="1">
                        </div>
                    </div>
                `;
            } else if (blockData.name === 'RSI') {
                paramsHtml = `
                    <div class="block-params">
                        <div class="param-group">
                            <label>Per√≠odo</label>
                            <input type="number" id="${blockId}_period" value="14" min="2" max="50" step="1">
                        </div>
                    </div>
                `;
            } else if (blockData.name === 'MACD') {
                paramsHtml = `
                    <div class="block-params">
                        <div class="param-group">
                            <label>R√°pido</label>
                            <input type="number" id="${blockId}_fast" value="12" min="2" max="50" step="1">
                        </div>
                        <div class="param-group">
                            <label>Lento</label>
                            <input type="number" id="${blockId}_slow" value="26" min="2" max="100" step="1">
                        </div>
                        <div class="param-group">
                            <label>Se√±al</label>
                            <input type="number" id="${blockId}_signal" value="9" min="2" max="50" step="1">
                        </div>
                    </div>
                `;
            } else if (blockData.name === 'BBands') {
                paramsHtml = `
                    <div class="block-params">
                        <div class="param-group">
                            <label>Per√≠odo</label>
                            <input type="number" id="${blockId}_period" value="20" min="5" max="100" step="1">
                        </div>
                        <div class="param-group">
                            <label>Desv. Std</label>
                            <input type="number" id="${blockId}_std" value="2" min="0.5" max="5" step="0.1">
                        </div>
                        <div class="param-group">
                            <label>Banda</label>
                            <select id="${blockId}_band">
                                <option value="upper">Superior</option>
                                <option value="middle">Media</option>
                                <option value="lower">Inferior</option>
                            </select>
                        </div>
                    </div>
                `;
            } else if (blockData.name === 'ATR') {
                paramsHtml = `
                    <div class="block-params">
                        <div class="param-group">
                            <label>Per√≠odo</label>
                            <input type="number" id="${blockId}_period" value="14" min="2" max="100" step="1">
                        </div>
                    </div>
                `;
            } else if (blockData.name === 'Swing') {
                paramsHtml = `
                    <div class="block-params">
                        <div class="param-group">
                            <label>Tipo</label>
                            <select id="${blockId}_type">
                                <option value="high">High</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        <div class="param-group">
                            <label>Lookback</label>
                            <input type="number" id="${blockId}_lookback" value="20" min="5" max="100" step="1">
                        </div>
                    </div>
                `;
            } else if (blockData.name === 'Number') {
                paramsHtml = `
                    <div class="block-params">
                        <div class="param-group">
                            <label>Valor</label>
                            <input type="number" id="${blockId}_value" value="0" step="0.01">
                        </div>
                    </div>
                `;
            } else if (blockData.name === 'Percentage') {
                paramsHtml = `
                    <div class="block-params">
                        <div class="param-group">
                            <label>Porcentaje (%)</label>
                            <input type="number" id="${blockId}_value" value="1" min="0" max="100" step="0.1">
                        </div>
                    </div>
                `;
            } else if (blockData.name === 'GreaterThan' || blockData.name === 'LessThan' || blockData.name === 'GreaterOrEqual' || blockData.name === 'LessOrEqual' || blockData.name === 'Equal' || blockData.name === 'NotEqual' || blockData.name === 'Crosses') {
                const symbol = blockData.name === 'GreaterThan' ? '>' : 
                             blockData.name === 'LessThan' ? '<' : 
                             blockData.name === 'GreaterOrEqual' ? '‚â•' : 
                             blockData.name === 'LessOrEqual' ? '‚â§' : 
                             blockData.name === 'Equal' ? '=' : 
                             blockData.name === 'NotEqual' ? '‚â†' : '‚úñ';
                paramsHtml = `
                    <div class="block-params">
                        <div class="param-group">
                            <label>Comparar</label>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <input type="text" id="${blockId}_left" placeholder="ej: price, ema50" style="flex: 1;">
                                <span style="font-weight: bold;">${symbol}</span>
                                <input type="text" id="${blockId}_right" placeholder="ej: ema50, swing" style="flex: 1;">
                            </div>
                        </div>
                    </div>
                `;
            }
            
            droppedBlock.innerHTML = `
                <div class="dropped-block-header">
                    <div class="dropped-block-title">
                        ${getBlockIcon(blockData.name)}
                        <span>${getBlockLabel(blockData.name)}</span>
                    </div>
                    <div class="block-actions">
                        <button class="move-block" onclick="moveBlockUp('${blockId}', '${zone}')" title="Mover arriba">‚ñ≤</button>
                        <button class="move-block" onclick="moveBlockDown('${blockId}', '${zone}')" title="Mover abajo">‚ñº</button>
                        <button class="remove-block" onclick="removeBlock('${blockId}', '${zone}')">‚úï</button>
                    </div>
                </div>
                ${paramsHtml}
            `;
            
            contentElement.appendChild(droppedBlock);
            
            // Restaurar par√°metros guardados si existen
            if (blockData.params) {
                Object.keys(blockData.params).forEach(oldParamId => {
                    // Extraer el sufijo del par√°metro (ej: "block_5_period" -> "_period")
                    const paramSuffix = oldParamId.substring(oldParamId.indexOf('_', oldParamId.indexOf('_') + 1));
                    const newParamId = blockId + paramSuffix;
                    
                    const input = document.getElementById(newParamId);
                    if (input) {
                        input.value = blockData.params[oldParamId];
                    } else {
                        console.warn(`Input not found: ${newParamId} for saved param: ${oldParamId}`);
                    }
                });
            }
            
            // Guardar en configuraci√≥n
            strategyConfig[zone].push({
                id: blockId,
                type: blockData.type,
                name: blockData.name
            });
            
            // Actualizar botones de movimiento
            updateMoveButtons(zone);
            
            // Actualizar informaci√≥n de estrategia
            updateStrategyInfo();
        }

        function removeBlock(blockId, zone) {
            const block = document.querySelector(`[data-block-id="${blockId}"]`);
            if (block) {
                block.remove();
            }
            
            // Remover de configuraci√≥n
            strategyConfig[zone] = strategyConfig[zone].filter(b => b.id !== blockId);
            
            // Si la zona qued√≥ vac√≠a, mostrar mensaje
            const zoneElement = document.querySelector(`[data-zone="${zone}"]`);
            const contentElement = zoneElement.querySelector('.drop-zone-content');
            if (contentElement.children.length === 0) {
                const lang = localStorage.getItem('language') || 'en';
                const msg = lang === 'es' ? 'Arrastra bloques aqu√≠' : 'Drag blocks here';
                contentElement.innerHTML = `<div class="drop-zone-empty">${msg}</div>`;
            } else {
                // Actualizar botones de movimiento
                updateMoveButtons(zone);
            }
            
            // Actualizar informaci√≥n de estrategia
            updateStrategyInfo();
        }

        function moveBlockUp(blockId, zone) {
            const zoneElement = document.querySelector(`[data-zone="${zone}"]`);
            const contentElement = zoneElement.querySelector('.drop-zone-content');
            const blocks = Array.from(contentElement.querySelectorAll('.dropped-block'));
            const blockElement = document.querySelector(`[data-block-id="${blockId}"]`);
            const currentIndex = blocks.indexOf(blockElement);
            
            if (currentIndex > 0) {
                // Intercambiar con el bloque anterior
                const previousBlock = blocks[currentIndex - 1];
                contentElement.insertBefore(blockElement, previousBlock);
                
                // Actualizar configuraci√≥n
                const temp = strategyConfig[zone][currentIndex];
                strategyConfig[zone][currentIndex] = strategyConfig[zone][currentIndex - 1];
                strategyConfig[zone][currentIndex - 1] = temp;
                
                // Actualizar botones de movimiento
                updateMoveButtons(zone);
                updateStrategyInfo();
            }
        }

        function moveBlockDown(blockId, zone) {
            const zoneElement = document.querySelector(`[data-zone="${zone}"]`);
            const contentElement = zoneElement.querySelector('.drop-zone-content');
            const blocks = Array.from(contentElement.querySelectorAll('.dropped-block'));
            const blockElement = document.querySelector(`[data-block-id="${blockId}"]`);
            const currentIndex = blocks.indexOf(blockElement);
            
            if (currentIndex < blocks.length - 1) {
                // Intercambiar con el bloque siguiente
                const nextBlock = blocks[currentIndex + 1];
                contentElement.insertBefore(nextBlock, blockElement);
                
                // Actualizar configuraci√≥n
                const temp = strategyConfig[zone][currentIndex];
                strategyConfig[zone][currentIndex] = strategyConfig[zone][currentIndex + 1];
                strategyConfig[zone][currentIndex + 1] = temp;
                
                // Actualizar botones de movimiento
                updateMoveButtons(zone);
                updateStrategyInfo();
            }
        }

        function updateMoveButtons(zone) {
            const zoneElement = document.querySelector(`[data-zone="${zone}"]`);
            const contentElement = zoneElement.querySelector('.drop-zone-content');
            const blocks = Array.from(contentElement.querySelectorAll('.dropped-block'));
            
            blocks.forEach((block, index) => {
                const upButton = block.querySelector('.move-block:nth-of-type(1)');
                const downButton = block.querySelector('.move-block:nth-of-type(2)');
                
                if (upButton) {
                    upButton.disabled = (index === 0);
                }
                if (downButton) {
                    downButton.disabled = (index === blocks.length - 1);
                }
            });
        }

        function clearStrategy() {
            const lang = localStorage.getItem('language') || 'en';
            const confirmMsg = lang === 'es' 
                ? '¬øEst√°s seguro de limpiar toda la estrategia?' 
                : 'Are you sure you want to clear the entire strategy?';
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            clearStrategyWithoutConfirm();
        }

        function clearStrategyWithoutConfirm() {
            strategyConfig = {
                entry_long: [],
                exit_long: [],
                entry_short: [],
                exit_short: []
            };
            
            const lang = localStorage.getItem('language') || 'en';
            const msg = lang === 'es' ? 'Arrastra bloques aqu√≠' : 'Drag blocks here';
            document.querySelectorAll('.drop-zone-content').forEach(content => {
                content.innerHTML = `<div class="drop-zone-empty">${msg}</div>`;
            });
            
            // Actualizar informaci√≥n de estrategia
            updateStrategyInfo();
        }

        function loadBlocksToZone(zoneId, blocks) {
            console.log(`üì¶ loadBlocksToZone called for ${zoneId}:`, blocks);
            
            if (!blocks || !Array.isArray(blocks) || blocks.length === 0) {
                console.log(`  ‚ö†Ô∏è No blocks to load for ${zoneId}`);
                return;
            }
            
            // Convertir zoneId a data-zone value
            // entry_long_zone -> entry_long
            const zoneName = zoneId.replace('_zone', '');
            console.log(`  üéØ Zone name: ${zoneName}`);
            
            blocks.forEach((blockData, index) => {
                console.log(`  üìå Adding block ${index + 1}/${blocks.length}:`, blockData);
                addBlockToZone(zoneName, blockData);
            });
            
            console.log(`  ‚úÖ Loaded ${blocks.length} block(s) to ${zoneName}`);
        }

        function loadDefaultStrategy() {
            clearStrategy();
            
            const lang = localStorage.getItem('language') || 'en';
            const msg = lang === 'es'
                ? 'Usa el constructor visual para crear tu estrategia.\n\nEjemplo:\n- Arrastra "Precio" y "EMA" a las zonas\n- Usa el operador "Mayor que (>)" para compararlos\n- Configura los par√°metros seg√∫n tus necesidades'
                : 'Use the visual builder to create your strategy.\n\nExample:\n- Drag "Price" and "EMA" to the zones\n- Use the "Greater than (>)" operator to compare them\n- Configure parameters according to your needs';
            
            alert(msg);
        }

        function showGuide() {
            const lang = localStorage.getItem('language') || 'en';
            
            const guide = lang === 'es' ? `
üéØ GU√çA DE USO - VISUAL STRATEGY BUILDER

üì¶ INDICADORES:
‚Ä¢ EMA/SMA: Medias m√≥viles
‚Ä¢ RSI: Fuerza relativa (14 t√≠pico)
‚Ä¢ MACD: Convergencia/Divergencia
‚Ä¢ Bollinger: Bandas de volatilidad
‚Ä¢ ATR: Rango verdadero
‚Ä¢ Swing: M√°ximos/M√≠nimos locales

üí∞ VALORES:
‚Ä¢ Precio: Precio actual
‚Ä¢ N√∫mero: Valor fijo
‚Ä¢ Porcentaje: Valores en %

‚ö° OPERADORES:
‚Ä¢ > < >= <= == !=: Comparaciones
‚Ä¢ Cruza (‚úñ): Detecta cruces

üéØ L√ìGICA:
‚Ä¢ AND/OR: Combina condiciones
‚Ä¢ NOT/XOR/NAND/NOR: L√≥gica avanzada

üìù EJEMPLO:
1. Arrastra "Precio" a "Entrada LONG"
2. Arrastra ">" (Mayor que)
3. Arrastra "EMA" ‚Üí configura 50

üí° TIP: Los datos se descargan autom√°ticamente!

‚ö†Ô∏è AVISO IMPORTANTE SOBRE BACKTESTING:
Los resultados del backtest se basan √öNICAMENTE en datos hist√≥ricos del pasado. Un backtest NO es:
‚Ä¢ ‚ùå Un or√°culo o m√°quina predictora del futuro
‚Ä¢ ‚ùå Una garant√≠a de rendimiento futuro
‚Ä¢ ‚ùå Asesoramiento financiero profesional

El mercado es din√°mico y puede comportarse diferente en el futuro. Los resultados pasados NO garantizan resultados futuros. Use esta herramienta solo con fines educativos y de prueba.
            ` : `
üéØ USER GUIDE - VISUAL STRATEGY BUILDER

üì¶ INDICATORS:
‚Ä¢ EMA/SMA: Moving averages
‚Ä¢ RSI: Relative strength (typical 14)
‚Ä¢ MACD: Convergence/Divergence
‚Ä¢ Bollinger: Volatility bands
‚Ä¢ ATR: Average True Range
‚Ä¢ Swing: Local highs/lows

üí∞ VALUES:
‚Ä¢ Price: Current price
‚Ä¢ Number: Fixed value
‚Ä¢ Percentage: Percentage values

‚ö° OPERATORS:
‚Ä¢ > < >= <= == !=: Comparisons
‚Ä¢ Crosses (‚úñ): Detects crossovers

üéØ LOGIC:
‚Ä¢ AND/OR: Combine conditions
‚Ä¢ NOT/XOR/NAND/NOR: Advanced logic

üìù EXAMPLE:
1. Drag "Price" to "LONG Entry"
2. Drag ">" (Greater than)
3. Drag "EMA" ‚Üí set to 50

üí° TIP: Data downloads automatically!

‚ö†Ô∏è IMPORTANT BACKTEST DISCLAIMER:
Backtest results are based ONLY on historical past data. A backtest is NOT:
‚Ä¢ ‚ùå An oracle or future prediction machine
‚Ä¢ ‚ùå A guarantee of future performance
‚Ä¢ ‚ùå Professional financial advice

Markets are dynamic and may behave differently in the future. Past results do NOT guarantee future results. Use this tool for educational and testing purposes only.
            `;
            
            alert(guide);
        }
        
        // ==================== EXPORT/IMPORT STRATEGY ====================
        
        function exportStrategy() {
            const lang = localStorage.getItem('language') || 'en';
            
            // Recolectar todos los bloques de cada zona
            const strategy = {
                version: "2.2",
                timestamp: new Date().toISOString(),
                entry_long: extractBlocksFromZone('entry_long_zone'),
                exit_long: extractBlocksFromZone('exit_long_zone'),
                entry_short: extractBlocksFromZone('entry_short_zone'),
                exit_short: extractBlocksFromZone('exit_short_zone')
            };
            
            // Validar que hay al menos una estrategia
            const hasBlocks = strategy.entry_long.length > 0 || 
                             strategy.exit_long.length > 0 || 
                             strategy.entry_short.length > 0 || 
                             strategy.exit_short.length > 0;
            
            if (!hasBlocks) {
                const msg = lang === 'es' 
                    ? 'No hay estrategia para exportar. Arrastra bloques primero.'
                    : 'No strategy to export. Drag blocks first.';
                alert(msg);
                return;
            }
            
            // Crear archivo JSON
            const dataStr = JSON.stringify(strategy, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            // Descargar archivo
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `strategy_${new Date().getTime()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            const successMsg = lang === 'es'
                ? '‚úÖ Estrategia exportada exitosamente!'
                : '‚úÖ Strategy exported successfully!';
            alert(successMsg);
        }
        
        function extractBlocksFromZone(zoneId) {
            const zone = document.getElementById(zoneId);
            if (!zone) {
                console.warn(`Zone not found: ${zoneId}`);
                return [];
            }
            
            const blocks = [];
            const blockElements = zone.querySelectorAll('.dropped-block');
            
            blockElements.forEach(block => {
                const blockData = {
                    type: block.dataset.type,
                    name: block.dataset.name,
                    params: {}
                };
                
                // Extraer valores de par√°metros
                const inputs = block.querySelectorAll('input, select');
                inputs.forEach(input => {
                    if (input.id) {
                        blockData.params[input.id] = input.value;
                    }
                });
                
                blocks.push(blockData);
            });
            
            return blocks;
        }
        
        function importStrategy(event) {
            const lang = localStorage.getItem('language') || 'en';
            const file = event.target.files[0];
            
            if (!file) return;
            
            console.log('üì• Importing strategy file:', file.name);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    console.log('üìÑ File read successfully, parsing JSON...');
                    const strategy = JSON.parse(e.target.result);
                    
                    console.log('‚úÖ JSON parsed successfully:', strategy);
                    
                    // Validar estructura b√°sica
                    if (!strategy.version || !strategy.entry_long) {
                        console.error('‚ùå Invalid strategy structure:', strategy);
                        const errorMsg = lang === 'es'
                            ? '‚ùå Error al importar estrategia. Verifica que el archivo sea v√°lido.'
                            : '‚ùå Error importing strategy. Verify the file is valid.';
                        alert(errorMsg);
                        return;
                    }
                    
                    console.log('üßπ Clearing current strategy...');
                    // Limpiar estrategia actual
                    clearStrategyWithoutConfirm();
                    
                    console.log('üì¶ Loading blocks to zones...');
                    // Cargar bloques en cada zona
                    loadBlocksToZone('entry_long_zone', strategy.entry_long);
                    console.log('  ‚úì Entry LONG loaded');
                    
                    loadBlocksToZone('exit_long_zone', strategy.exit_long);
                    console.log('  ‚úì Exit LONG loaded');
                    
                    loadBlocksToZone('entry_short_zone', strategy.entry_short);
                    console.log('  ‚úì Entry SHORT loaded');
                    
                    loadBlocksToZone('exit_short_zone', strategy.exit_short);
                    console.log('  ‚úì Exit SHORT loaded');
                    
                    console.log('üîÑ Updating strategy info...');
                    // Actualizar informaci√≥n de estrategia
                    updateStrategyInfo();
                    
                    console.log('‚úÖ Strategy imported successfully!');
                    const successMsg = lang === 'es'
                        ? '‚úÖ Estrategia importada exitosamente!'
                        : '‚úÖ Strategy imported successfully!';
                    alert(successMsg);
                } catch (error) {
                    console.error('‚ùå Error importing strategy:', error);
                    console.error('Error stack:', error.stack);
                    const errorMsg = lang === 'es'
                        ? `‚ùå Error al leer el archivo: ${error.message}`
                        : `‚ùå Error reading file: ${error.message}`;
                    alert(errorMsg);
                }
            };
            
            reader.onerror = function(error) {
                console.error('‚ùå FileReader error:', error);
                const errorMsg = lang === 'es'
                    ? '‚ùå Error al leer el archivo.'
                    : '‚ùå Error reading the file.';
                alert(errorMsg);
            };
            
            reader.readAsText(file);
            
            // Reset input para permitir reimportar el mismo archivo
            event.target.value = '';
        }
        
        // ==================== BACKTEST RESULT IMPORT/EXPORT ====================
        
        let lastBacktestResult = null; // Guardar el √∫ltimo resultado del backtest
        
        function exportBacktestResult() {
            const lang = localStorage.getItem('language') || 'en';
            
            if (!lastBacktestResult) {
                const msg = lang === 'es' 
                    ? 'No hay resultados de backtest para exportar. Ejecuta un backtest primero.'
                    : 'No backtest results to export. Run a backtest first.';
                alert(msg);
                return;
            }
            
            // Crear archivo JSON con el resultado completo
            const dataStr = JSON.stringify(lastBacktestResult, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            // Descargar archivo
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            const filename = `backtest_result_${lastBacktestResult.config.symbol}_${new Date().getTime()}.json`;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            const successMsg = lang === 'es'
                ? '‚úÖ Resultado del backtest exportado exitosamente!'
                : '‚úÖ Backtest result exported successfully!';
            alert(successMsg);
        }
        
        function importBacktestResult(event) {
            const lang = localStorage.getItem('language') || 'en';
            const file = event.target.files[0];
            
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const result = JSON.parse(e.target.result);
                    
                    // Validar estructura b√°sica del resultado
                    if (!result || typeof result !== 'object') {
                        throw new Error('Invalid JSON structure');
                    }
                    
                    // Si tiene stats o config, es v√°lido
                    if (!result.stats && !result.config) {
                        throw new Error('Missing stats or config');
                    }
                    
                    // Guardar resultado y mostrar
                    lastBacktestResult = result;
                    displayResults(result);
                    
                    // Mostrar bot√≥n de exportar
                    const exportBtn = document.getElementById('exportBacktestBtn');
                    if (exportBtn) {
                        exportBtn.style.display = 'inline-block';
                    }
                    
                    const successMsg = lang === 'es'
                        ? '‚úÖ Resultado del backtest importado exitosamente!'
                        : '‚úÖ Backtest result imported successfully!';
                    
                    // Usar setTimeout para mostrar el mensaje despu√©s de que se rendericen los resultados
                    setTimeout(() => {
                        alert(successMsg);
                    }, 300);
                    
                } catch (error) {
                    const errorMsg = lang === 'es'
                        ? '‚ùå Error al importar resultado. Verifica que el archivo sea v√°lido.'
                        : '‚ùå Error importing result. Verify the file is valid.';
                    alert(errorMsg);
                    console.error('Import error:', error);
                }
            };
            
            reader.readAsText(file);
            
            // Reset input para permitir reimportar el mismo archivo
            event.target.value = '';
        }

        function getBlockIcon(name) {
            const icons = {
                'EMA': 'üìä',
                'SMA': 'üìà',
                'RSI': '‚ö°',
                'MACD': 'üåä',
                'BBands': 'üìè',
                'ATR': 'üìä',
                'Swing': 'üîÑ',
                'Price': 'üíµ',
                'Number': 'üî¢',
                'Percentage': 'üìä',
                'GreaterThan': '>',
                'LessThan': '<',
                'GreaterOrEqual': '‚â•',
                'LessOrEqual': '‚â§',
                'Equal': '=',
                'NotEqual': '‚â†',
                'Crosses': '‚úñÔ∏è',
                'AND': '‚àß',
                'OR': '‚à®',
                'NOT': '¬¨',
                'XOR': '‚äï',
                'NAND': '‚äº',
                'NOR': '‚äΩ'
            };
            return icons[name] || 'üì¶';
        }

        function getBlockLabel(name) {
            const labels = {
                'EMA': 'EMA',
                'SMA': 'SMA',
                'RSI': 'RSI',
                'MACD': 'MACD',
                'BBands': 'Bollinger Bands',
                'ATR': 'ATR',
                'Swing': 'Swing',
                'Price': 'Precio',
                'Number': 'N√∫mero',
                'Percentage': 'Porcentaje %',
                'GreaterThan': 'Mayor que (>)',
                'LessThan': 'Menor que (<)',
                'GreaterOrEqual': 'Mayor o Igual (‚â•)',
                'LessOrEqual': 'Menor o Igual (‚â§)',
                'Equal': 'Igual (=)',
                'NotEqual': 'Diferente (‚â†)',
                'Crosses': 'Cruza',
                'AND': 'Y (AND)',
                'OR': 'O (OR)',
                'NOT': 'NO (NOT)',
                'XOR': 'XOR',
                'NAND': 'NAND',
                'NOR': 'NOR'
            };
            return labels[name] || name;
        }

        function getStrategyParams() {
            // Extraer par√°metros de todos los bloques
            const params = {
                indicators: [],
                conditions: {}
            };
            
            // Buscar bloques EMA - solo si existen
            const emaBlocks = document.querySelectorAll('.dropped-block[data-name="EMA"]');
            if (emaBlocks.length > 0) {
                const firstEMA = emaBlocks[0].querySelector('[id$="_period"]');
                if (firstEMA && firstEMA.value) {
                    params.ema_period = parseInt(firstEMA.value);
                }
            }
            
            // Buscar bloques Swing - solo si existen
            const swingBlocks = document.querySelectorAll('.dropped-block[data-name="Swing"]');
            if (swingBlocks.length > 0) {
                const firstSwing = swingBlocks[0].querySelector('[id$="_lookback"]');
                if (firstSwing && firstSwing.value) {
                    params.swing_lookback = parseInt(firstSwing.value);
                }
            }
            
            // Recopilar todos los indicadores configurados
            document.querySelectorAll('.dropped-block[data-type="indicator"]').forEach(block => {
                const indicator = {
                    type: block.dataset.name,
                    params: {}
                };
                
                // Extraer par√°metros espec√≠ficos
                block.querySelectorAll('input, select').forEach(input => {
                    const paramName = input.id.split('_').pop();
                    indicator.params[paramName] = input.value;
                });
                
                params.indicators.push(indicator);
            });
            
            return params;
        }

        // ==================== DARK MODE ====================
        
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');

            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
        }

        // Cargar preferencia de modo oscuro
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
        
        // ==================== MENU UNIVERSAL - VER universal_menu.js ====================
        
        // Funci√≥n de logout (usada por el men√∫ universal)
        function logout() {
            if (confirm('¬øEst√°s seguro de que deseas cerrar sesi√≥n?')) {
                fetch('/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(() => {
                    window.location.href = '/welcome';
                });
            }
        }
        
        // Verificar si es admin
        function checkAdminStatus() {
            fetch('/api/auth/me')
                .then(res => res.json())
                .then(data => {
                    if (data.success && data.user && data.user.role === 'admin') {
                        const adminLink = document.getElementById('adminMenuLink');
                        if (adminLink) {
                            adminLink.style.display = 'block';
                        }
                    }
                })
                .catch(err => console.error('Error verificando rol:', err));
        }
        
        // Llamar al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', checkAdminStatus);

        // ==================== LANGUAGE TOGGLE ====================
        
        let currentLang = localStorage.getItem('language') || 'en';
        
        function translateBlocks() {
            const lang = currentLang || 'es';
            
            const blockTranslations = {
                'EMA': {
                    name: 'EMA',
                    desc: { es: 'Media Exp.', en: 'Exp. Avg.' }
                },
                'SMA': {
                    name: 'SMA',
                    desc: { es: 'Media Simple', en: 'Simple Avg.' }
                },
                'RSI': {
                    name: 'RSI',
                    desc: { es: 'Fuerza', en: 'Strength' }
                },
                'MACD': {
                    name: 'MACD',
                    desc: { es: 'Momentum', en: 'Momentum' }
                },
                'BBands': {
                    name: 'Bollinger',
                    desc: { es: 'Volatilidad', en: 'Volatility' }
                },
                'ATR': {
                    name: 'ATR',
                    desc: { es: 'Rango', en: 'Range' }
                },
                'Swing': {
                    name: 'Swing',
                    desc: { es: 'M√°x/M√≠n', en: 'High/Low' }
                },
                'Price': {
                    name: { es: 'Precio', en: 'Price' },
                    desc: { es: 'Actual', en: 'Current' }
                },
                'Number': {
                    name: { es: 'N√∫mero', en: 'Number' },
                    desc: { es: 'Fijo', en: 'Fixed' }
                },
                'Percentage': {
                    name: { es: 'Porcentaje', en: 'Percentage' },
                    desc: '%'
                },
                'GreaterThan': {
                    name: { es: 'Mayor', en: 'Greater' },
                    desc: 'A > B'
                },
                'LessThan': {
                    name: { es: 'Menor', en: 'Less' },
                    desc: 'A < B'
                },
                'GreaterOrEqual': {
                    name: { es: 'Mayor/Igual', en: 'Greater/Equal' },
                    desc: 'A ‚â• B'
                },
                'LessOrEqual': {
                    name: { es: 'Menor/Igual', en: 'Less/Equal' },
                    desc: 'A ‚â§ B'
                },
                'Equal': {
                    name: { es: 'Igual', en: 'Equal' },
                    desc: 'A = B'
                },
                'NotEqual': {
                    name: { es: 'Diferente', en: 'Different' },
                    desc: 'A ‚â† B'
                },
                'Crosses': {
                    name: { es: 'Cruza', en: 'Crosses' },
                    desc: 'Crossover'
                },
                'AND': {
                    name: 'AND',
                    desc: { es: 'A y B', en: 'A and B' }
                },
                'OR': {
                    name: 'OR',
                    desc: { es: 'A o B', en: 'A or B' }
                },
                'NOT': {
                    name: 'NOT',
                    desc: { es: 'Niega', en: 'Negates' }
                },
                'XOR': {
                    name: 'XOR',
                    desc: { es: 'Solo uno', en: 'Only one' }
                },
                'NAND': {
                    name: 'NAND',
                    desc: { es: 'NO ambos', en: 'NOT both' }
                },
                'NOR': {
                    name: 'NOR',
                    desc: { es: 'Ninguno', en: 'Neither' }
                }
            };
            
            // Traducir bloques en la paleta
            document.querySelectorAll('.blocks-palette .block').forEach(block => {
                const blockName = block.getAttribute('data-name');
                const translation = blockTranslations[blockName];
                
                if (translation) {
                    const icon = block.querySelector('.block-icon');
                    const iconText = icon ? icon.textContent : '';
                    
                    const name = typeof translation.name === 'object' ? translation.name[lang] : translation.name;
                    const desc = typeof translation.desc === 'object' ? translation.desc[lang] : translation.desc;
                    
                    block.innerHTML = `<span class="block-icon">${iconText}</span> ${name}<br><small>${desc}</small>`;
                }
            });
            
            // Traducir bloques arrastrados
            document.querySelectorAll('.dropped-block').forEach(droppedBlock => {
                const blockName = droppedBlock.getAttribute('data-name');
                const translation = blockTranslations[blockName];
                
                if (translation) {
                    const nameSpan = droppedBlock.querySelector('.block-name');
                    if (nameSpan) {
                        const name = typeof translation.name === 'object' ? translation.name[lang] : translation.name;
                        nameSpan.textContent = name;
                    }
                }
            });
        }
        
        function toggleLanguage() {
            currentLang = currentLang === 'es' ? 'en' : 'es';
            localStorage.setItem('language', currentLang);
            
            // Actualizar todos los elementos con atributos data-lang
            document.querySelectorAll('[data-lang-es]').forEach(el => {
                const text = currentLang === 'es' ? el.getAttribute('data-lang-es') : el.getAttribute('data-lang-en');
                if (text) {
                    // Usar innerHTML para mantener el emoji inicial en t√≠tulos y spans con HTML
                    if (el.tagName === 'H1' || el.tagName === 'H2' || el.tagName === 'H3' || el.tagName === 'H4' || el.tagName === 'SPAN' || el.tagName === 'STRONG') {
                        el.innerHTML = text;
                    } else if (el.tagName === 'BUTTON') {
                        el.innerHTML = text;
                    } else {
                        el.textContent = text;
                    }
                }
            });
            
            // Actualizar placeholders de inputs
            document.querySelectorAll('[data-placeholder-es]').forEach(el => {
                const placeholder = currentLang === 'es' ? el.getAttribute('data-placeholder-es') : el.getAttribute('data-placeholder-en');
                if (placeholder) {
                    el.placeholder = placeholder;
                }
            });
            
            // Actualizar opciones de select (como timeframe)
            document.querySelectorAll('option[data-lang-es]').forEach(option => {
                const text = currentLang === 'es' ? option.getAttribute('data-lang-es') : option.getAttribute('data-lang-en');
                if (text) {
                    option.textContent = text;
                }
            });
            
            // Traducir bloques de la paleta
            translateBlocks();
            
            // Actualizar informaci√≥n de estrategia
            updateStrategyInfo();
            
            // Mostrar alerta temporal
            const langAlert = document.createElement('div');
            langAlert.style.cssText = `
                position: fixed;
                bottom: 30px;
                right: 30px;
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: bold;
            `;
            langAlert.textContent = currentLang === 'es' ? '‚úÖ Idioma: Espa√±ol' : '‚úÖ Language: English';
            document.body.appendChild(langAlert);
            
            setTimeout(() => langAlert.remove(), 2000);
        }
        
        // Cargar preferencia de idioma
        if (currentLang === 'en') {
            const langToggle = document.querySelector('.lang-toggle');
            if (langToggle) {
                langToggle.textContent = 'üåê ES';
            }
            document.querySelectorAll('[data-lang-en]').forEach(el => {
                const text = el.getAttribute('data-lang-en');
                if (text) {
                    if (el.tagName === 'H1' || el.tagName === 'H2' || el.tagName === 'H3' || el.tagName === 'H4' || el.tagName === 'SPAN' || el.tagName === 'STRONG' || el.tagName === 'BUTTON') {
                        el.innerHTML = text;
                    } else {
                        el.textContent = text;
                    }
                }
            });
            document.querySelectorAll('[data-placeholder-en]').forEach(el => {
                const placeholder = el.getAttribute('data-placeholder-en');
                if (placeholder) el.placeholder = placeholder;
            });
            document.querySelectorAll('option[data-lang-en]').forEach(option => {
                option.textContent = option.getAttribute('data-lang-en');
            });
            translateBlocks();
            updateStrategyInfo();
        }

        // ==================== LOADER FUNCTIONS ====================
        
        function showLoader(text = null, subtext = null) {
            const lang = localStorage.getItem('language') || 'en';
            const overlay = document.getElementById('loaderOverlay');
            const loaderText = document.getElementById('loaderText');
            const loaderSubtext = document.getElementById('loaderSubtext');
            
            if (text) {
                loaderText.textContent = text;
            } else {
                loaderText.textContent = lang === 'es' ? 'Procesando...' : 'Processing...';
            }
            
            if (subtext) {
                loaderSubtext.textContent = subtext;
            } else {
                loaderSubtext.textContent = lang === 'es' ? 'Por favor espere' : 'Please wait';
            }
            
            overlay.classList.add('active');
        }
        
        function hideLoader() {
            const overlay = document.getElementById('loaderOverlay');
            overlay.classList.remove('active');
        }

        // ==================== BOT MANAGEMENT SYSTEM ====================
        
        // Inicializar arrays INMEDIATAMENTE (antes de cualquier funci√≥n)
        let userBots = [];
        let botIntervals = {};
        let originalModalContent = null; // Para guardar el contenido original del modal
        
        // Cargar desde localStorage inmediatamente si existe
        try {
            const savedBots = localStorage.getItem('userBots');
            if (savedBots) {
                userBots = JSON.parse(savedBots);
            }
        } catch (e) {
            console.error('Error cargando bots desde localStorage:', e);
            userBots = [];
        }

        // Cargar bots al iniciar
        document.addEventListener('DOMContentLoaded', function() {
            loadUserBots();
            initStrategyBuilder();
            updateStrategyInfo();
            
            // Guardar el contenido original del modal
            const modalContent = document.getElementById('createBotModalContent');
            if (modalContent) {
                originalModalContent = modalContent.innerHTML;
            }
        });

        // Cargar todos los bots del usuario
        async function loadUserBots() {
            console.log('üîÑ === INICIANDO CARGA DE BOTS ===');
            try {
                // Intentar cargar desde localStorage primero (modo offline)
                const savedBots = localStorage.getItem('userBots');
                console.log('üì¶ localStorage userBots:', savedBots ? `Encontrado (${savedBots.length} caracteres)` : 'NO encontrado');
                
                if (savedBots) {
                    userBots = JSON.parse(savedBots);
                    console.log(`‚úÖ ${userBots.length} bots cargados desde localStorage:`, userBots.map(b => b.name));
                    renderBotsList();
                    // Iniciar monitoreo de bots activos
                    const activeBots = userBots.filter(bot => bot.status === 'active');
                    console.log(`üöÄ ${activeBots.length} bots activos para monitorear`);
                    activeBots.forEach(bot => {
                        startBotMonitoring(bot.id);
                    });
                    // NO return aqu√≠, intentar sincronizar con servidor
                }
                
                // Intentar cargar desde el servidor
                console.log('üåê Intentando cargar desde servidor...');
                const response = await fetch('/api/signal-bots/list');
                console.log('üì° Respuesta del servidor:', response.status, response.statusText);
                const contentType = response.headers.get('content-type');
                console.log('üìÑ Content-Type:', contentType);
                
                if (response.ok && contentType && contentType.includes('application/json')) {
                    const serverBots = await response.json();
                    console.log(`‚úÖ ${serverBots.length} bots cargados desde servidor:`, serverBots.map(b => b.name));
                    
                    // Actualizar con datos del servidor Y forzar ignore_position_tracking = true
                    userBots = serverBots.map(bot => ({
                        ...bot,
                        ignore_position_tracking: true  // Forzar siempre a true
                    }));
                    localStorage.setItem('userBots', JSON.stringify(userBots));
                    console.log('üíæ Bots sincronizados con localStorage');
                    renderBotsList();
                    
                    // Iniciar monitoreo de bots activos
                    const activeBots = userBots.filter(bot => bot.status === 'active');
                    console.log(`üöÄ ${activeBots.length} bots activos para monitorear (desde servidor)`);
                    activeBots.forEach(bot => {
                        startBotMonitoring(bot.id);
                    });
                } else {
                    // Servidor no disponible, usar modo local
                    console.warn('‚ö†Ô∏è API no disponible, usando almacenamiento local');
                    if (!savedBots) {
                        userBots = [];
                        console.log('üìù Array de bots inicializado vac√≠o');
                    }
                    renderBotsList();
                }
                
                console.log('üèÅ === CARGA DE BOTS COMPLETADA ===');
            } catch (error) {
                console.error('‚ùå Error loading bots:', error);
                // Cargar desde localStorage como fallback
                const savedBots = localStorage.getItem('userBots');
                if (savedBots) {
                    userBots = JSON.parse(savedBots);
                    console.log(`‚úÖ FALLBACK: ${userBots.length} bots cargados desde localStorage`);
                } else {
                    userBots = [];
                    console.log('üìù FALLBACK: Array de bots inicializado vac√≠o');
                }
                renderBotsList();
            }
        }

        // Renderizar la lista de bots
        function renderBotsList() {
            console.log('üé® === RENDERIZANDO LISTA DE BOTS ===');
            const container = document.getElementById('bots_list');
            
            if (!container) {
                console.error('‚ùå No se encontr√≥ el contenedor bots_list');
                return;
            }
            
            const lang = localStorage.getItem('language') || 'en';
            const isDark = document.body.classList.contains('dark-mode');
            
            console.log(`üìä Total de bots a renderizar: ${userBots.length}`);
            userBots.forEach((bot, index) => {
                console.log(`  Bot ${index + 1}:`, {
                    id: bot.id,
                    name: bot.name,
                    status: bot.status,
                    symbol: bot.symbol,
                    timeframe: bot.timeframe
                });
            });
            
            if (userBots.length === 0) {
                console.log('üì≠ Lista de bots vac√≠a, mostrando mensaje');
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <p style="font-size: 1.2em;">
                            ${lang === 'es' ? 'üìã No tienes bots creados a√∫n' : 'üìã You don\'t have any bots yet'}
                        </p>
                        <p style="font-size: 0.9em; margin-top: 10px;">
                            ${lang === 'es' ? 'Crea tu primer bot con la estrategia que dise√±aste arriba' : 'Create your first bot with the strategy you designed above'}
                        </p>
                    </div>
                `;
                return;
            }
            
            console.log('‚úÖ Generando HTML para', userBots.length, 'bots');

            container.innerHTML = userBots.map(bot => `
                <div class="bot-card" id="bot_card_${bot.id}" style="
                    background: ${isDark ? '#2a2a3e' : 'white'};
                    border: 2px solid ${bot.status === 'active' ? '#28a745' : '#6c757d'};
                    border-radius: 12px;
                    padding: 25px;
                    margin-bottom: 20px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                    transition: all 0.3s;
                ">
                    <!-- Header del Bot -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                        <div style="flex: 1; min-width: 200px;">
                            <h3 style="margin: 0 0 5px 0; color: ${isDark ? '#fff' : '#333'};">
                                ü§ñ ${bot.name}
                            </h3>
                            <p style="margin: 0; color: #999; font-size: 0.9em;">
                                ${bot.symbol} ‚Ä¢ ${bot.timeframe}
                            </p>
                        </div>
                        
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <span style="
                                padding: 8px 16px;
                                border-radius: 20px;
                                font-weight: 600;
                                font-size: 0.85em;
                                background: ${bot.status === 'active' ? 'linear-gradient(135deg, #28a745 0%, #20c997 100%)' : '#6c757d'};
                                color: white;
                                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                            ">
                                ${bot.status === 'active' ? 'üü¢ ' + (lang === 'es' ? 'ACTIVO' : 'ACTIVE') : '‚è∏Ô∏è ' + (lang === 'es' ? 'PAUSADO' : 'PAUSED')}
                            </span>
                        </div>
                    </div>

                    <!-- Estad√≠sticas del Bot -->
                    <div style="
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                        gap: 15px;
                        margin-bottom: 20px;
                    ">
                        <div style="background: ${isDark ? '#1e1e2e' : '#f8f9fa'}; padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="margin: 0; font-size: 0.8em; color: #999;">${lang === 'es' ? 'Se√±ales Enviadas' : 'Signals Sent'}</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.4em; font-weight: 600; color: ${isDark ? '#fff' : '#333'};">
                                ${bot.signals_sent || 0}
                            </p>
                        </div>
                        <div style="background: ${isDark ? '#1e1e2e' : '#f8f9fa'}; padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="margin: 0; font-size: 0.8em; color: #999;">${lang === 'es' ? 'Tiempo Activo' : 'Uptime'}</p>
                            <p style="margin: 5px 0 0 0; font-size: 1.4em; font-weight: 600; color: ${isDark ? '#fff' : '#333'};">
                                ${formatUptime(bot.uptime || 0)}
                            </p>
                        </div>
                        <div style="background: ${isDark ? '#1e1e2e' : '#f8f9fa'}; padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="margin: 0; font-size: 0.8em; color: #999;">${lang === 'es' ? '√öltima Se√±al' : 'Last Signal'}</p>
                            <p style="margin: 5px 0 0 0; font-size: 0.9em; font-weight: 600; color: ${isDark ? '#fff' : '#333'};">
                                ${bot.last_signal ? formatTimeAgo(bot.last_signal, lang) : (lang === 'es' ? 'Ninguna' : 'None')}
                            </p>
                        </div>
                    </div>

                    <!-- √öltima se√±al enviada -->
                    ${bot.last_signal_text ? `
                        <div style="
                            background: ${isDark ? '#1e1e2e' : '#e7f3ff'};
                            border-left: 4px solid #2196f3;
                            padding: 15px;
                            border-radius: 8px;
                            margin-bottom: 20px;
                        ">
                            <p style="margin: 0 0 5px 0; font-weight: 600; color: ${isDark ? '#8a9ef5' : '#2196f3'}; font-size: 0.85em;">
                                ${lang === 'es' ? 'üì° √öLTIMA SE√ëAL' : 'üì° LAST SIGNAL'}
                            </p>
                            <pre style="margin: 0; white-space: pre-wrap; font-size: 0.9em; color: ${isDark ? '#e0e0e0' : '#333'};">${bot.last_signal_text}</pre>
                        </div>
                    ` : ''}

                    <!-- Botones de acci√≥n -->
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        ${bot.status === 'active' ? `
                            <button onclick="pauseBot('${bot.id}')" class="btn-secondary" style="
                                flex: 1;
                                min-width: 120px;
                                background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
                                box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
                            ">
                                ‚è∏Ô∏è ${lang === 'es' ? 'Pausar' : 'Pause'}
                            </button>
                            <button onclick="forceCheckNow('${bot.id}', event)" class="btn-secondary" style="
                                flex: 1;
                                min-width: 120px;
                                background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
                                box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
                            ">
                                üîç ${lang === 'es' ? 'Verificar Ahora' : 'Check Now'}
                            </button>
                        ` : `
                            <button onclick="activateBot('${bot.id}')" class="btn-secondary" style="
                                flex: 1;
                                min-width: 120px;
                                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                                box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
                            ">
                                ‚ñ∂Ô∏è ${lang === 'es' ? 'Activar' : 'Activate'}
                            </button>
                        `}
                        
                        <button onclick="editBot('${bot.id}')" class="btn-secondary" style="
                            flex: 1;
                            min-width: 120px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                        ">
                            ‚úèÔ∏è ${lang === 'es' ? 'Editar' : 'Edit'}
                        </button>
                        
                        <button onclick="viewBotLogs('${bot.id}')" class="btn-secondary" style="
                            flex: 1;
                            min-width: 120px;
                            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
                            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
                        ">
                            üìä ${lang === 'es' ? 'Historial' : 'History'}
                        </button>
                        
                        <button onclick="deleteBot('${bot.id}')" class="btn-secondary" style="
                            min-width: 100px;
                            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
                            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
                        ">
                            üóëÔ∏è ${lang === 'es' ? 'Eliminar' : 'Delete'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Formatear tiempo de actividad
        function formatUptime(seconds) {
            if (seconds < 60) return `${seconds}s`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h`;
           
            return `${Math.floor(seconds / 86400)}d`;
        }

        // Formatear tiempo transcurrido
        function formatTimeAgo(timestamp, lang) {
            const now = Date.now();
            const diff = now - timestamp;
            const seconds = Math.floor(diff / 1000);
            
            if (seconds < 60) return lang === 'es' ? 'Ahora' : 'Now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}${lang === 'es' ? 'min' : 'm'}`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}${lang === 'es' ? 'h' : 'h'}`;
            return `${Math.floor(seconds / 86400)}${lang === 'es' ? 'd' : 'd'}`;
        }

        // Actualizar s√≠mbolo completo combinando activo + par
        function updateFullSymbol() {
            const assetSymbol = document.getElementById('modal_asset_symbol').value.trim().toUpperCase();
            const quoteAsset = document.getElementById('modal_quote_asset').value;
            const symbolInput = document.getElementById('modal_symbol');
            const preview = document.getElementById('full_symbol_preview');
            
            if (assetSymbol && quoteAsset) {
                const fullSymbol = assetSymbol + quoteAsset;
                symbolInput.value = fullSymbol;
                preview.textContent = fullSymbol;
                preview.style.color = '#667eea';
            } else if (assetSymbol) {
                preview.textContent = assetSymbol + '...';
                preview.style.color = '#999';
            } else {
                preview.textContent = '-';
                preview.style.color = '#999';
                symbolInput.value = '';
            }
        }

        // Mostrar modal para crear bot
        function showCreateBotModal() {
            const lang = localStorage.getItem('language') || 'en';
            
            // Verificar que hay una estrategia creada
            const hasBlocks = document.querySelectorAll('.dropped-block').length > 0;
            if (!hasBlocks) {
                alert(lang === 'es' 
                    ? '‚ö†Ô∏è Primero debes crear una estrategia usando los bloques visuales en la Secci√≥n 2' 
                    : '‚ö†Ô∏è You must first create a strategy using the visual blocks in Section 2');
                // Scroll a la secci√≥n de strategy builder
                document.querySelector('.strategy-builder').scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            // Restaurar el modal al contenido original si fue modificado
            const modalContent = document.getElementById('createBotModalContent');
            if (!document.getElementById('createBotForm') && originalModalContent && modalContent) {
                modalContent.innerHTML = originalModalContent;
            }
            
            // Limpiar formulario
            document.getElementById('edit_bot_id').value = '';
            document.getElementById('bot_name').value = '';
            document.getElementById('modal_bot_token').value = '';
            document.getElementById('modal_chat_id').value = '';
            document.getElementById('modal_asset_symbol').value = '';
            document.getElementById('modal_quote_asset').value = 'USDT';
            document.getElementById('modal_symbol').value = '';
            document.getElementById('modal_timeframe').value = '15m';
            document.getElementById('full_symbol_preview').textContent = '-';
            
            // Actualizar t√≠tulo
            document.getElementById('modalTitle').textContent = lang === 'es' ? 'Crear Nuevo Bot' : 'Create New Bot';
            
            // Cargar y mostrar la estrategia traducida en lenguaje humano
            const strategyReadable = document.getElementById('strategy_human_readable');
            if (strategyReadable) {
                const humanStrategy = translateStrategyToHuman(lang);
                if (humanStrategy) {
                    strategyReadable.innerHTML = `<div style="color: white; font-weight: 500;">${humanStrategy}</div>`;
                } else {
                    strategyReadable.innerHTML = `<p style="margin: 0; color: rgba(255,255,255,0.8); font-style: italic;">${lang === 'es' ? 'No se pudo cargar la estrategia' : 'Could not load strategy'}</p>`;
                }
            }
            
            // Mostrar modal
            document.getElementById('createBotModal').style.display = 'flex';
        }

        // Guardar configuraci√≥n del bot
        async function saveBotConfig(event) {
            event.preventDefault();
            const lang = localStorage.getItem('language') || 'en';
            
            // üîí VERIFICAR L√çMITE DE SUSCRIPCI√ìN
            const allowed = await window.subscriptionManager.executeIfAllowed('signal_bot', null);
            if (!allowed) {
                console.log('‚ùå L√≠mite de signal_bots alcanzado');
                return;
            }
            
            // Mostrar loader
            const loaderText = lang === 'es' ? 'Guardando bot...' : 'Saving bot...';
            const loaderSubtext = lang === 'es' ? 'Configurando estrategia' : 'Configuring strategy';
            showLoader(loaderText, loaderSubtext);
            
            console.log('üîß Iniciando saveBotConfig...');
            
            const botId = document.getElementById('edit_bot_id').value;
            const botName = document.getElementById('bot_name').value.trim();
            const botToken = document.getElementById('modal_bot_token').value.trim();
            const chatId = document.getElementById('modal_chat_id').value.trim();
            
            // Obtener s√≠mbolo del input (ya est√° actualizado por el selector)
            const symbol = document.getElementById('modal_symbol').value.trim().toUpperCase();
            
            // Validar que se haya ingresado un s√≠mbolo
            if (!symbol) {
                hideLoader();
                const errorMsg = lang === 'es' 
                    ? '‚ö†Ô∏è Por favor ingresa un s√≠mbolo v√°lido (ej: BTCUSDT)' 
                    : '‚ö†Ô∏è Please enter a valid symbol (eg: BTCUSDT)';
                alert(errorMsg);
                return;
            }
            
            const timeframe = document.getElementById('modal_timeframe').value;
            const ignoreTracking = true; // Siempre enviar se√±ales cuando se cumpla la condici√≥n
            
            // Calcular check_interval basado en el timeframe
            const timeframeToSeconds = {
                '1m': 60,
                '5m': 300,
                '15m': 900,
                '1h': 3600,
                '4h': 14400,
                '1d': 86400
            };
            const checkInterval = timeframeToSeconds[timeframe] || 900; // Default 15 minutos
            
            console.log('üìù Datos del formulario:', { botName, symbol, timeframe, checkInterval });
            
            // Obtener la estrategia actual
            const strategy = {
                entry_long: extractBlocksFromZone('entry_long_zone'),
                exit_long: extractBlocksFromZone('exit_long_zone'),
                entry_short: extractBlocksFromZone('entry_short_zone'),
                exit_short: extractBlocksFromZone('exit_short_zone')
            };
            
            console.log('üéØ Estrategia extra√≠da:', strategy);
            
            const botConfig = {
                id: botId || generateBotId(),
                name: botName,
                bot_token: botToken,
                chat_id: chatId,
                symbol: symbol,
                timeframe: timeframe,
                check_interval: checkInterval,
                strategy: strategy,
                ignore_position_tracking: ignoreTracking,
                status: 'paused',
                signals_sent: 0,
                uptime: 0,
                last_signal: null,
                last_signal_text: null,
                created_at: Date.now()
            };
            
            console.log('ü§ñ Configuraci√≥n del bot completa:', botConfig);
            
            // Intentar guardar en el servidor PRIMERO
            try {
                const url = botId ? `/api/signal-bots/update/${botId}` : '/api/signal-bots/create';
                const method = botId ? 'PUT' : 'POST';
                
                console.log(`üì° Enviando ${method} a ${url}...`);
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(botConfig)
                });
                
                if (response.ok) {
                    const serverData = await response.json();
                    console.log('‚úÖ Bot guardado en el servidor:', serverData);
                    
                    // Actualizar con el ID del servidor si es un bot nuevo
                    const newBotId = serverData.bot_id || botConfig.id;
                    console.log('üîÑ Bot ID del servidor:', newBotId);
                    
                    // Si estamos editando un bot local, actualizar su ID al del servidor
                    if (botId && botId.toString().includes('_')) {
                        // Es un bot local que se est√° sincronizando, actualizar su ID
                        console.log('üîÑ Cambiando ID local', botId, 'por ID servidor', newBotId);
                        
                        // Eliminar el bot local viejo
                        userBots = userBots.filter(b => b.id !== botId);
                        
                        // Agregar con el nuevo ID
                        botConfig.id = newBotId;
                        botConfig.server_connected = true;
                        userBots.push(botConfig);
                    } else if (botId) {
                        // Actualizar bot existente
                        const index = userBots.findIndex(b => b.id == botId);
                        if (index !== -1) {
                            userBots[index] = { ...userBots[index], ...botConfig, id: newBotId, server_connected: true };
                        } else {
                            botConfig.id = newBotId;
                            botConfig.server_connected = true;
                            userBots.push(botConfig);
                        }
                    } else {
                        // Bot nuevo
                        botConfig.id = newBotId;
                        botConfig.server_connected = true;
                        userBots.push(botConfig);
                    }
                    
                    // Guardar en localStorage
                    localStorage.setItem('userBots', JSON.stringify(userBots));
                    console.log('üíæ Bot guardado con ID:', botConfig.id);
                    
                    closeBotModal();
                    renderBotsList();
                    
                    const successMsg = lang === 'es'
                        ? (botId ? '‚úÖ Bot actualizado correctamente\n\nüü¢ Conectado al servidor\nüí° Ahora puedes usar todas las funciones avanzadas' : '‚úÖ Bot creado correctamente\n\nüü¢ Conectado al servidor\nüí° Ahora puedes usar todas las funciones avanzadas')
                        : (botId ? '‚úÖ Bot updated successfully\n\nüü¢ Connected to server\nüí° You can now use all advanced features' : '‚úÖ Bot created successfully\n\nüü¢ Connected to server\nüí° You can now use all advanced features');
                    
                    hideLoader();
                    alert(successMsg);
                    console.log('‚úÖ saveBotConfig completado exitosamente (modo servidor)');
                    
                    // Recargar p√°gina autom√°ticamente
                    setTimeout(() => {
                        location.reload();
                    }, 500);
                    return;
                }
                
                // Si llegamos aqu√≠, el servidor respondi√≥ pero con error
                console.warn('‚ö†Ô∏è Servidor respondi√≥ con error:', response.status);
                const errorData = await response.json().catch(() => ({}));
                console.warn('Error del servidor:', errorData);
                
                // Continuar con modo local...
                
            } catch (error) {
                console.warn('‚ö†Ô∏è No se pudo conectar al servidor:', error.message);
                
                // Mostrar alerta al usuario sobre el modo local
                const localWarning = lang === 'es'
                    ? '‚ö†Ô∏è NO SE PUDO CONECTAR AL SERVIDOR\n\nEl bot se guardar√° solo localmente (en tu navegador).\n\n‚ùå NO podr√°s usar:\n‚Ä¢ üîç Verificar Ahora\n‚Ä¢ ‚ñ∂Ô∏è Activar/Pausar desde el servidor\n‚Ä¢ üìä Ver historial de se√±ales\n‚Ä¢ üì° Enviar se√±ales autom√°ticas\n\n‚úÖ Aseg√∫rate de que el servidor est√© corriendo:\n   python app.py\n\n¬øDeseas guardar el bot solo localmente de todas formas?\n\nüí° Tip: Puedes editarlo despu√©s cuando el servidor est√© corriendo.'
                    : '‚ö†Ô∏è COULD NOT CONNECT TO SERVER\n\nThe bot will be saved locally only (in your browser).\n\n‚ùå You will NOT be able to:\n‚Ä¢ üîç Check Now\n‚Ä¢ ‚ñ∂Ô∏è Activate/Pause from server\n‚Ä¢ üìä View signal history\n‚Ä¢ üì° Send automatic signals\n\n‚úÖ Make sure the server is running:\n   python app.py\n\nDo you want to save the bot locally anyway?\n\nüí° Tip: You can edit it later when the server is running.';
                
                if (!confirm(localWarning)) {
                    console.log('‚ùå Usuario cancel√≥ el guardado local');
                    hideLoader();
                    return; // Usuario cancela, no guardar
                }
                
                console.log('‚úÖ Usuario acept√≥ guardar localmente');
                // Continuar con modo local...
            }
            
            // MODO LOCAL (solo si el servidor fall√≥)
            console.log('üíæ Guardando bot en modo local...');
            
            // Asegurar que tiene un ID local
            if (!botConfig.id) {
                botConfig.id = generateBotId();
            }
            botConfig.server_connected = false;
            
            if (botId) {
                const index = userBots.findIndex(b => b.id === botId);
                if (index !== -1) {
                    userBots[index] = { ...userBots[index], ...botConfig };
                    console.log('‚úèÔ∏è Bot actualizado en √≠ndice:', index);
                }
            } else {
                userBots.push(botConfig);
                console.log('‚ûï Nuevo bot agregado. Total bots:', userBots.length);
            }
            
            // Guardar en localStorage
            localStorage.setItem('userBots', JSON.stringify(userBots));
            console.log('üíæ Bots guardados en localStorage (modo local)');
            
            closeBotModal();
            renderBotsList();
            console.log('üé® Lista de bots renderizada');
            
            const successMsg = lang === 'es'
                ? '‚ö†Ô∏è Bot guardado SOLO LOCALMENTE\n\nüî¥ El servidor no est√° disponible.\n\nEl bot NO enviar√° se√±ales reales hasta que:\n1. Ejecutes python app.py\n2. Recrees el bot'
                : '‚ö†Ô∏è Bot saved LOCALLY ONLY\n\nüî¥ Server is not available.\n\nBot will NOT send real signals until:\n1. You run python app.py\n2. Recreate the bot';
            
            hideLoader();
            alert(successMsg);
            console.log('‚úÖ saveBotConfig completado exitosamente (modo local)');
            
            // Recargar p√°gina autom√°ticamente
            setTimeout(() => {
                location.reload();
            }, 500);
        }
        
        // Generar ID √∫nico para el bot
        function generateBotId() {
            return 'bot_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Verificar estado del bot en el servidor
        async function checkBotStatus(botId) {
            const lang = localStorage.getItem('language') || 'en';
            
            try {
                const response = await fetch(`/api/signal-bots/get/${botId}`);
                
                if (response.ok) {
                    const serverBot = await response.json();
                    
                    // Actualizar bot local con datos del servidor
                    const index = userBots.findIndex(b => b.id === botId);
                    if (index !== -1) {
                        userBots[index] = { ...userBots[index], ...serverBot, server_connected: true };
                        localStorage.setItem('userBots', JSON.stringify(userBots));
                        renderBotsList();
                    }
                    
                    const statusMsg = lang === 'es' 
                        ? `‚úÖ SERVIDOR CONECTADO\n\nüìä Estado del Bot:\n‚Ä¢ Status: ${serverBot.status}\n‚Ä¢ Se√±ales enviadas: ${serverBot.signals_sent || 0}\n‚Ä¢ √öltima se√±al: ${serverBot.last_signal ? new Date(serverBot.last_signal).toLocaleString() : 'Ninguna'}\n\n${serverBot.status === 'active' ? 'üü¢ El bot est√° activo y monitoreando el mercado' : '‚è∏Ô∏è El bot est√° pausado'}`
                        : `‚úÖ SERVER CONNECTED\n\nüìä Bot Status:\n‚Ä¢ Status: ${serverBot.status}\n‚Ä¢ Signals sent: ${serverBot.signals_sent || 0}\n‚Ä¢ Last signal: ${serverBot.last_signal ? new Date(serverBot.last_signal).toLocaleString() : 'None'}\n\n${serverBot.status === 'active' ? 'üü¢ Bot is active and monitoring the market' : '‚è∏Ô∏è Bot is paused'}`;
                    
                    alert(statusMsg);
                } else {
                    throw new Error('Server not responding');
                }
            } catch (error) {
                console.error('Error checking bot status:', error);
                
                // Marcar como no conectado
                const bot = userBots.find(b => b.id === botId);
                if (bot) {
                    bot.server_connected = false;
                    localStorage.setItem('userBots', JSON.stringify(userBots));
                    renderBotsList();
                }
                
                alert(lang === 'es'
                    ? 'üî¥ NO SE PUEDE CONECTAR AL SERVIDOR\n\n‚ö†Ô∏è El bot est√° guardado localmente pero el servidor no est√° respondiendo.\n\nüìã Para que env√≠e se√±ales reales:\n1. Aseg√∫rate que app.py est√© ejecut√°ndose\n2. Verifica que no haya errores en la consola del servidor\n3. Intenta activar el bot nuevamente'
                    : 'üî¥ CANNOT CONNECT TO SERVER\n\n‚ö†Ô∏è Bot is saved locally but server is not responding.\n\nüìã For real signal sending:\n1. Make sure app.py is running\n2. Check for errors in server console\n3. Try activating the bot again');
            }
        }
        
        // Activar bot
        async function activateBot(botId) {
            const lang = localStorage.getItem('language') || 'en';
            
            try {
                const response = await fetch(`/api/signal-bots/activate/${botId}`, {
                    method: 'POST'
                });
                
                const contentType = response.headers.get('content-type');
                
                if (response.ok && contentType && contentType.includes('application/json')) {
                    const bot = userBots.find(b => b.id === botId);
                    if (bot) {
                        bot.status = 'active';
                        bot.server_connected = true;
                        localStorage.setItem('userBots', JSON.stringify(userBots));
                        renderBotsList();
                        startBotMonitoring(botId);
                    }
                    
                    alert(lang === 'es' 
                        ? '‚úÖ Bot activado correctamente\n\nü§ñ El bot est√° monitoreando el mercado y enviar√° se√±ales a Telegram cuando se cumplan las condiciones.' 
                        : '‚úÖ Bot activated successfully\n\nü§ñ The bot is monitoring the market and will send signals to Telegram when conditions are met.');
                } else {
                    // Modo local
                    const bot = userBots.find(b => b.id === botId);
                    if (bot) {
                        bot.status = 'active';
                        bot.server_connected = false;
                        localStorage.setItem('userBots', JSON.stringify(userBots));
                        renderBotsList();
                        startBotMonitoring(botId);
                    }
                    
                    alert(lang === 'es' 
                        ? '‚ö†Ô∏è Bot "activado" SOLO LOCALMENTE\n\n‚ùå IMPORTANTE: El bot NO est√° funcionando realmente.\n\nüî¥ NO enviar√° se√±ales a Telegram\nüî¥ NO puede usar "Verificar Ahora"\nüî¥ NO monitorea el mercado\n\n‚úÖ Para que funcione de verdad:\n1. Aseg√∫rate de que el servidor est√© corriendo:\n   python app.py\n\n2. Edita el bot (‚úèÔ∏è) y gu√°rdalo nuevamente\n\n3. El bot se sincronizar√° con el servidor\n\n4. Entonces S√ç funcionar√° completamente'
                        : '‚ö†Ô∏è Bot "activated" LOCALLY ONLY\n\n‚ùå IMPORTANT: The bot is NOT actually working.\n\nüî¥ Will NOT send signals to Telegram\nüî¥ Cannot use "Check Now"\nüî¥ Does NOT monitor the market\n\n‚úÖ To make it work for real:\n1. Make sure server is running:\n   python app.py\n\n2. Edit the bot (‚úèÔ∏è) and save it again\n\n3. Bot will sync with server\n\n4. Then it WILL work completely');
                }
            } catch (error) {
                console.error('Error activating bot:', error);
                // Activar localmente
                const bot = userBots.find(b => b.id === botId);
                if (bot) {
                    bot.status = 'active';
                    bot.server_connected = false;
                    localStorage.setItem('userBots', JSON.stringify(userBots));
                    renderBotsList();
                    startBotMonitoring(botId);
                }
                alert(lang === 'es' 
                    ? '‚ö†Ô∏è Bot activado localmente\n\nüî¥ No se pudo conectar al servidor. El bot NO enviar√° se√±ales reales.'
                    : '‚ö†Ô∏è Bot activated locally\n\nüî¥ Could not connect to server. Bot will NOT send real signals.');
            }
        }

        // Pausar bot
        async function pauseBot(botId) {
            const lang = localStorage.getItem('language') || 'en';
            
            try {
                const response = await fetch(`/api/signal-bots/pause/${botId}`, {
                    method: 'POST'
                });
                
                const contentType = response.headers.get('content-type');
                
                if (response.ok && contentType && contentType.includes('application/json')) {
                    const bot = userBots.find(b => b.id === botId);
                    if (bot) {
                        bot.status = 'paused';
                        renderBotsList();
                        stopBotMonitoring(botId);
                    }
                    
                    alert(lang === 'es' ? '‚è∏Ô∏è Bot pausado correctamente' : '‚è∏Ô∏è Bot paused successfully');
                } else {
                    // Modo local
                    const bot = userBots.find(b => b.id === botId);
                    if (bot) {
                        bot.status = 'paused';
                        localStorage.setItem('userBots', JSON.stringify(userBots));
                        renderBotsList();
                        stopBotMonitoring(botId);
                    }
                    
                    alert(lang === 'es' ? '‚è∏Ô∏è Bot pausado (modo local)' : '‚è∏Ô∏è Bot paused (local mode)');
                }
            } catch (error) {
                console.error('Error pausing bot:', error);
                // Pausar localmente
                const bot = userBots.find(b => b.id === botId);
                if (bot) {
                    bot.status = 'paused';
                    localStorage.setItem('userBots', JSON.stringify(userBots));
                    renderBotsList();
                    stopBotMonitoring(botId);
                }
                alert(lang === 'es' ? '‚è∏Ô∏è Bot pausado localmente' : '‚è∏Ô∏è Bot paused locally');
            }
        }

        // Editar bot
        async function editBot(botId) {
            const lang = localStorage.getItem('language') || 'en';
            
            // Buscar el bot localmente
            const bot = userBots.find(b => b.id === botId);
            
            if (bot) {
                // Restaurar el modal al contenido original si fue modificado
                const modalContent = document.getElementById('createBotModalContent');
                if (!document.getElementById('createBotForm') && originalModalContent && modalContent) {
                    modalContent.innerHTML = originalModalContent;
                }
                
                // Esperar un momento para que el DOM se actualice
                setTimeout(() => {
                    // Llenar formulario con datos del bot
                    document.getElementById('edit_bot_id').value = bot.id;
                    document.getElementById('bot_name').value = bot.name;
                    document.getElementById('modal_bot_token').value = bot.bot_token;
                    document.getElementById('modal_chat_id').value = bot.chat_id;
                    
                    // Configurar s√≠mbolo - intentar separar activo y par
                    const symbol = bot.symbol;
                    const quoteAssets = ['USDT', 'BUSD', 'USDC', 'USD', 'EUR', 'BTC', 'ETH', 'BNB'];
                    let assetSymbol = '';
                    let quoteAsset = 'USDT';
                    
                    // Buscar el par de cotizaci√≥n en el s√≠mbolo
                    for (const quote of quoteAssets) {
                        if (symbol.endsWith(quote)) {
                            assetSymbol = symbol.slice(0, -quote.length);
                            quoteAsset = quote;
                            break;
                        }
                    }
                    
                    // Si no se encontr√≥ un par conocido, usar el s√≠mbolo completo como activo
                    if (!assetSymbol) {
                        assetSymbol = symbol;
                    }
                    
                    document.getElementById('modal_asset_symbol').value = assetSymbol;
                    document.getElementById('modal_quote_asset').value = quoteAsset;
                    document.getElementById('modal_symbol').value = symbol;
                    updateFullSymbol();
                    
                    document.getElementById('modal_timeframe').value = bot.timeframe;
                    
                    // Cargar estrategia en el builder
                    if (bot.strategy) {
                        clearStrategyWithoutConfirm();
                        if (bot.strategy.entry_long) loadBlocksToZone('entry_long_zone', bot.strategy.entry_long);
                        if (bot.strategy.exit_long) loadBlocksToZone('exit_long_zone', bot.strategy.exit_long);
                        if (bot.strategy.entry_short) loadBlocksToZone('entry_short_zone', bot.strategy.entry_short);
                        if (bot.strategy.exit_short) loadBlocksToZone('exit_short_zone', bot.strategy.exit_short);
                    }
                    
                    // Actualizar t√≠tulo del modal
                    document.getElementById('modalTitle').textContent = lang === 'es' ? 'Editar Bot' : 'Edit Bot';
                    
                    // Cargar y mostrar la estrategia traducida en lenguaje humano
                    const strategyReadable = document.getElementById('strategy_human_readable');
                    if (strategyReadable) {
                        const humanStrategy = translateStrategyToHuman(lang);
                        if (humanStrategy) {
                            strategyReadable.innerHTML = `<div style="color: white; font-weight: 500;">${humanStrategy}</div>`;
                        } else {
                            strategyReadable.innerHTML = `<p style="margin: 0; color: rgba(255,255,255,0.8); font-style: italic;">${lang === 'es' ? 'No se pudo cargar la estrategia' : 'Could not load strategy'}</p>`;
                        }
                    }
                    
                    // Mostrar modal
                    document.getElementById('createBotModal').style.display = 'flex';
                    
                    // Scroll al strategy builder
                    setTimeout(() => {
                        const strategyBuilder = document.querySelector('.strategy-builder');
                        if (strategyBuilder) {
                            strategyBuilder.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 100);
                }, 50);
            } else {
                alert(lang === 'es' ? '‚ùå Bot no encontrado' : '‚ùå Bot not found');
            }
        }

        // Ver historial de se√±ales del bot
        async function viewBotLogs(botId) {
            const lang = localStorage.getItem('language') || 'en';
            const isDark = document.body.classList.contains('dark-mode');
            
            // Obtener el bot local
            const bot = userBots.find(b => b.id === botId);
            
            try {
                // Intentar obtener logs del servidor
                const response = await fetch(`/api/signal-bots/logs/${botId}`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    let logsHtml = '';
                    
                    if (data.logs && data.logs.length > 0) {
                        logsHtml = data.logs.map(log => {
                            const date = new Date(log.timestamp);
                            const formattedDate = date.toLocaleString(lang === 'es' ? 'es-ES' : 'en-US');
                            
                            let signalIcon = 'üì°';
                            let signalColor = '#667eea';
                            
                            if (log.type.includes('LONG')) {
                                signalIcon = log.type.includes('ENTRY') ? 'üü¢' : '‚ö™';
                                signalColor = log.type.includes('ENTRY') ? '#28a745' : '#6c757d';
                            } else if (log.type.includes('SHORT')) {
                                signalIcon = log.type.includes('ENTRY') ? 'üî¥' : '‚ö™';
                                signalColor = log.type.includes('ENTRY') ? '#dc3545' : '#6c757d';
                            }
                            
                            return `
                                <div style="
                                    background: ${isDark ? '#2a2a3e' : '#f8f9fa'};
                                    border-left: 4px solid ${signalColor};
                                    padding: 15px;
                                    margin-bottom: 15px;
                                    border-radius: 8px;
                                ">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span style="font-weight: 600; color: ${signalColor};">
                                            ${signalIcon} ${log.type.replace('_', ' ')}
                                        </span>
                                        <span style="color: #999; font-size: 0.85em;">
                                            ${formattedDate}
                                        </span>
                                    </div>
                                    <pre style="
                                        margin: 0;
                                        white-space: pre-wrap;
                                        font-size: 0.9em;
                                        color: ${isDark ? '#e0e0e0' : '#333'};
                                        font-family: monospace;
                                    ">${log.text}</pre>
                                </div>
                            `;
                        }).join('');
                        
                        // Informaci√≥n del estado del bot
                        if (data.bot_status) {
                            const status = data.bot_status;
                            logsHtml = `
                                <div style="
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    color: white;
                                    padding: 20px;
                                    border-radius: 10px;
                                    margin-bottom: 20px;
                                ">
                                    <h4 style="margin: 0 0 15px 0; color: white;">
                                        üìä ${lang === 'es' ? 'Estado del Bot' : 'Bot Status'}
                                    </h4>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                        <div>
                                            <div style="font-size: 0.85em; opacity: 0.8;">${lang === 'es' ? 'Estado' : 'Status'}</div>
                                            <div style="font-weight: 600; font-size: 1.2em;">
                                                ${status.running ? 'üü¢ ' + (lang === 'es' ? 'Activo' : 'Active') : '‚è∏Ô∏è ' + (lang === 'es' ? 'Pausado' : 'Paused')}
                                            </div>
                                        </div>
                                        <div>
                                            <div style="font-size: 0.85em; opacity: 0.8;">${lang === 'es' ? 'Se√±ales' : 'Signals'}</div>
                                            <div style="font-weight: 600; font-size: 1.2em;">${status.signals_sent || 0}</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 0.85em; opacity: 0.8;">${lang === 'es' ? 'Tiempo Activo' : 'Uptime'}</div>
                                            <div style="font-weight: 600; font-size: 1.2em;">${formatUptime(status.uptime || 0)}</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 0.85em; opacity: 0.8;">${lang === 'es' ? '√öltima Verificaci√≥n' : 'Last Check'}</div>
                                            <div style="font-weight: 600; font-size: 0.9em;">
                                                ${status.last_check ? new Date(status.last_check).toLocaleTimeString() : '-'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ` + logsHtml;
                        }
                        
                    } else {
                        logsHtml = `
                            <p style="text-align: center; color: #999; padding: 40px;">
                                üìã ${lang === 'es' ? 'No hay se√±ales registradas a√∫n' : 'No signals recorded yet'}
                                <br><br>
                                üí° ${lang === 'es' 
                                    ? 'Las se√±ales aparecer√°n aqu√≠ cuando el bot est√© activo y detecte condiciones de entrada/salida.' 
                                    : 'Signals will appear here when the bot is active and detects entry/exit conditions.'}
                            </p>
                        `;
                    }
                    
                    const modalContent = `
                        <div class="disclaimer-header">
                            <span style="font-size: 2em;">üìä</span>
                            <h2>${lang === 'es' ? 'Historial de' : 'History of'} ${bot ? bot.name : 'Bot'}</h2>
                        </div>
                        <div style="max-height: 500px; overflow-y: auto; padding: 20px;">
                            ${logsHtml}
                        </div>
                        <div style="margin-top: 20px; text-align: right; padding: 0 20px 20px;">
                            <button onclick="restoreModalAndClose()" class="disclaimer-btn disclaimer-btn-accept">
                                ${lang === 'es' ? 'Cerrar' : 'Close'}
                            </button>
                        </div>
                    `;
                    
                    // Mostrar en el modal existente
                    const modalContentElement = document.getElementById('createBotModalContent');
                    if (modalContentElement) {
                        modalContentElement.innerHTML = modalContent;
                        document.getElementById('createBotModal').style.display = 'flex';
                    }
                    
                } else {
                    throw new Error('Server error');
                }
                
            } catch (error) {
                console.log('Usando modo local para logs');
                
                // Modo local - mostrar mensaje
                const logsHtml = `
                    <p style="text-align: center; color: #999; padding: 40px;">
                        üìã ${lang === 'es' ? 'No hay se√±ales registradas a√∫n' : 'No signals recorded yet'}
                        <br><br>
                        üí° ${lang === 'es' 
                            ? 'El bot debe estar conectado al servidor y activo para registrar se√±ales.' 
                            : 'The bot must be connected to the server and active to record signals.'}
                    </p>
                `;
                
                const modalContent = `
                    <div class="disclaimer-header">
                        <span style="font-size: 2em;">üìä</span>
                        <h2>${lang === 'es' ? 'Historial de' : 'History of'} ${bot ? bot.name : 'Bot'}</h2>
                    </div>
                    <div style="max-height: 500px; overflow-y: auto; padding: 20px;">
                        ${logsHtml}
                    </div>
                    <div style="margin-top: 20px; text-align: right; padding: 0 20px 20px;">
                        <button onclick="restoreModalAndClose()" class="disclaimer-btn disclaimer-btn-accept">
                            ${lang === 'es' ? 'Cerrar' : 'Close'}
                        </button>
                    </div>
                `;
                
                // Mostrar en el modal existente
                const modalContentElement = document.getElementById('createBotModalContent');
                if (modalContentElement) {
                    modalContentElement.innerHTML = modalContent;
                    document.getElementById('createBotModal').style.display = 'flex';
                }
            }
        }
        
        // Restaurar el contenido original del modal y cerrarlo
        function restoreModalAndClose() {
            const modal = document.getElementById('createBotModal');
            const modalContent = document.getElementById('createBotModalContent');
            
            // Restaurar contenido original
            if (originalModalContent && modalContent) {
                modalContent.innerHTML = originalModalContent;
            }
            
            // Cerrar modal
            modal.style.display = 'none';
        }
        
        // Cerrar modal sin necesidad de restaurar (cuando ya est√° en formato de formulario)
        function closeBotModal() {
            const modal = document.getElementById('createBotModal');
            const modalContent = document.getElementById('createBotModalContent');
            
            // Si el modal ha sido modificado (no tiene el formulario), restaurar
            if (!document.getElementById('createBotForm')) {
                if (originalModalContent && modalContent) {
                    modalContent.innerHTML = originalModalContent;
                }
            }
            
            modal.style.display = 'none';
        }

        // Eliminar bot
        async function deleteBot(botId) {
            const lang = localStorage.getItem('language') || 'en';
            const bot = userBots.find(b => b.id === botId);
            
            const confirmMsg = lang === 'es'
                ? `¬øEst√°s seguro de que deseas eliminar el bot "${bot ? bot.name : 'este bot'}"?\n\nEsta acci√≥n no se puede deshacer.`
                : `Are you sure you want to delete the bot "${bot ? bot.name : 'this bot'}"?\n\nThis action cannot be undone.`;
            
            if (!confirm(confirmMsg)) return;
            
            // Mostrar loader
            const loaderText = lang === 'es' ? 'Eliminando bot...' : 'Deleting bot...';
            const loaderSubtext = lang === 'es' ? 'Por favor espere' : 'Please wait';
            showLoader(loaderText, loaderSubtext);
            
            try {
                const response = await fetch(`/api/signal-bots/delete/${botId}`, {
                    method: 'DELETE'
                });
                
                const contentType = response.headers.get('content-type');
                
                if (response.ok && contentType && contentType.includes('application/json')) {
                    stopBotMonitoring(botId);
                    await loadUserBots();
                    hideLoader();
                    alert(lang === 'es' ? '‚úÖ Bot eliminado correctamente' : '‚úÖ Bot deleted successfully');
                } else {
                    // Modo local
                    stopBotMonitoring(botId);
                    userBots = userBots.filter(b => b.id !== botId);
                    localStorage.setItem('userBots', JSON.stringify(userBots));
                    renderBotsList();
                    hideLoader();
                    alert(lang === 'es' ? '‚úÖ Bot eliminado (modo local)' : '‚úÖ Bot deleted (local mode)');
                }
            } catch (error) {
                console.error('Error deleting bot:', error);
                // Eliminar localmente
                stopBotMonitoring(botId);
                userBots = userBots.filter(b => b.id !== botId);
                localStorage.setItem('userBots', JSON.stringify(userBots));
                renderBotsList();
                hideLoader();
                alert(lang === 'es' ? '‚úÖ Bot eliminado localmente' : '‚úÖ Bot deleted locally');
            }
        }

        // Forzar verificaci√≥n inmediata del mercado
        async function forceCheckNow(botId, event) {
            const lang = localStorage.getItem('language') || 'en';
            const bot = userBots.find(b => b.id === botId);
            
            if (!bot) {
                alert(lang === 'es' ? '‚ùå Bot no encontrado' : '‚ùå Bot not found');
                return;
            }
            
            // Verificar si es un bot local (solo en localStorage, no en servidor)
            // Formato servidor: bot_6 (solo un n√∫mero despu√©s de bot_)
            // Formato local: bot_1736429846_abc123 (timestamp + random)
            const botIdStr = String(botId);
            let isLocalBot = false;
            
            if (botIdStr.startsWith('bot_')) {
                const afterPrefix = botIdStr.substring(4); // Quitar "bot_"
                // Si contiene otro guion bajo O tiene m√°s de 10 caracteres (no es solo un n√∫mero peque√±o)
                // entonces es un bot local
                if (afterPrefix.includes('_') || afterPrefix.length > 10) {
                    isLocalBot = true;
                }
            }
            
            if (isLocalBot) {
                const confirmMsg = lang === 'es'
                    ? '‚ö†Ô∏è Este bot solo existe localmente\n\n‚ùå No puede usar "Verificar Ahora" porque el bot no est√° en el servidor.\n\n‚úÖ Soluci√≥n:\n1. Haz clic en "‚úèÔ∏è Editar"\n2. Verifica que TODOS los campos est√©n completos (especialmente Bot Token y Chat ID)\n3. Guarda el bot\n4. El bot se sincronizar√° con el servidor\n\n¬øQuieres editar el bot ahora?'
                    : '‚ö†Ô∏è This bot only exists locally\n\n‚ùå Cannot use "Check Now" because the bot is not on the server.\n\n‚úÖ Solution:\n1. Click "‚úèÔ∏è Edit"\n2. Verify ALL fields are complete (especially Bot Token and Chat ID)\n3. Save the bot\n4. The bot will sync with the server\n\nDo you want to edit the bot now?';
                
                if (confirm(confirmMsg)) {
                    editBot(botId);
                }
                return;
            }
            
            if (bot.status !== 'active') {
                alert(lang === 'es' 
                    ? '‚ö†Ô∏è El bot debe estar activo para verificar el mercado' 
                    : '‚ö†Ô∏è The bot must be active to check the market');
                return;
            }
            
            // Mostrar indicador de carga
            const loadingMsg = lang === 'es' 
                ? 'üîç Verificando mercado...' 
                : 'üîç Checking market...';
            
            const btnElement = event ? event.target : null;
            const originalText = btnElement ? btnElement.innerHTML : '';
            if (btnElement) {
                btnElement.disabled = true;
                btnElement.innerHTML = loadingMsg;
            }
            
            try {
                const response = await fetch(`/api/signal-bots/check-now/${botId}`, {
                    method: 'POST'
                });
                
                // Verificar el tipo de contenido de la respuesta
                const contentType = response.headers.get('content-type');
                
                if (response.ok && contentType && contentType.includes('application/json')) {
                    const data = await response.json();
                    
                    if (data.success) {
                        alert(lang === 'es' 
                            ? `‚úÖ Verificaci√≥n completada\n\n${data.result.message}\n\nüïí √öltima verificaci√≥n: ${new Date(data.result.last_check).toLocaleTimeString()}`
                            : `‚úÖ Check completed\n\n${data.result.message}\n\nüïí Last check: ${new Date(data.result.last_check).toLocaleTimeString()}`);
                        
                        // Recargar bots para actualizar estad√≠sticas
                        await loadUserBots();
                    } else {
                        alert(lang === 'es' 
                            ? `‚ùå Error: ${data.error || 'No se pudo verificar el mercado'}`
                            : `‚ùå Error: ${data.error || 'Could not check the market'}`);
                    }
                } else if (response.status === 404) {
                    alert(lang === 'es' 
                        ? '‚ùå Bot no encontrado en el servidor\n\nEste bot debe ser guardado primero en el servidor antes de poder verificarlo manualmente.\n\nUsa el bot√≥n "Crear Nuevo Bot" para guardarlo con todos sus datos.'
                        : '‚ùå Bot not found on server\n\nThis bot must be saved to the server first before you can manually verify it.\n\nUse the "Create New Bot" button to save it with all its data.');
                } else {
                    // Intentar parsear JSON si es posible
                    try {
                        const errorData = await response.json();
                        alert(lang === 'es' 
                            ? `‚ùå ${errorData.message || errorData.error || 'El bot no est√° corriendo en el servidor'}\n\nAseg√∫rate de que el bot est√© activo y conectado.`
                            : `‚ùå ${errorData.message || errorData.error || 'Bot is not running on the server'}\n\nMake sure the bot is active and connected.`);
                    } catch {
                        alert(lang === 'es' 
                            ? `‚ùå Error del servidor (${response.status})\n\nEl servidor devolvi√≥ una respuesta inesperada.`
                            : `‚ùå Server error (${response.status})\n\nThe server returned an unexpected response.`);
                    }
                }
            } catch (error) {
                console.error('Error forcing check:', error);
                alert(lang === 'es' 
                    ? '‚ùå Error de conexi√≥n\n\nNo se pudo conectar con el servidor. Verifica que el servidor est√© corriendo.'
                    : '‚ùå Connection error\n\nCould not connect to the server. Verify the server is running.');
            } finally {
                // Restaurar bot√≥n
                if (btnElement) {
                    btnElement.disabled = false;
                    btnElement.innerHTML = originalText;
                }
            }
        }

        // Iniciar monitoreo de un bot (polling para actualizar estad√≠sticas)
        function startBotMonitoring(botId) {
            // Convertir a string para verificaciones
            const botIdStr = String(botId);
            
            // Detener monitoreo existente si hay
            stopBotMonitoring(botIdStr);
            
            // Solo monitorear bots que est√°n en el servidor (ID num√©rico o formato bot_NUMERO)
            // Los bots con formato bot_timestamp_random solo est√°n en localStorage
            if (botIdStr.includes('_') && botIdStr.startsWith('bot_')) {
                const parts = botIdStr.replace('bot_', '').split('_');
                // Si tiene m√°s de una parte despu√©s de 'bot_', es un ID local (bot_timestamp_random)
                if (parts.length > 1) {
                    console.log(`Bot ${botIdStr} es local, no se monitorear√° desde el servidor`);
                    return;
                }
            }
            
            // Iniciar nuevo intervalo
            botIntervals[botIdStr] = setInterval(async () => {
                try {
                    const response = await fetch(`/api/signal-bots/get/${botIdStr}`);
                    if (response.ok) {
                        const updatedBot = await response.json();
                        
                        // Actualizar en el array local
                        const index = userBots.findIndex(b => String(b.id) === botIdStr);
                        if (index !== -1) {
                            userBots[index] = updatedBot;
                            renderBotsList();
                        }
                    } else if (response.status === 404) {
                        // Bot no encontrado en servidor, detener monitoreo
                        stopBotMonitoring(botIdStr);
                    }
                } catch (error) {
                    // No mostrar error para bots locales
                    if (!botIdStr.includes('_')) {
                        console.error('Error monitoring bot:', error);
                    }
                }
            }, 5000); // Actualizar cada 5 segundos
        }

        // Detener monitoreo de un bot
        function stopBotMonitoring(botId) {
            if (botIntervals[botId]) {
                clearInterval(botIntervals[botId]);
                delete botIntervals[botId];
            }
        }

        // Toggle temporal del tracking de posiciones
        // ==================== FUNCIONES DEL MODAL ====================
        
        // Mostrar/ocultar token en el modal
        function toggleModalTokenVisibility() {
            const input = document.getElementById('modal_bot_token');
            if (input.type === 'password') {
                input.type = 'text';
            } else {
                input.type = 'password';
            }
        }

        // Obtener Chat ID desde el modal
        async function getModalChatId() {
            const botToken = document.getElementById('modal_bot_token').value.trim();
            const lang = localStorage.getItem('language') || 'en';
            
            if (!botToken) {
                alert(lang === 'es' ? 'Por favor ingresa el Bot Token primero' : 'Please enter the Bot Token first');
                return;
            }
            
            try {
                const response = await fetch('/api/telegram/get-chat-id', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ bot_token: botToken })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    document.getElementById('modal_chat_id').value = data.chat_id;
                    alert(lang === 'es' 
                        ? `‚úÖ Chat ID obtenido: ${data.chat_id}` 
                        : `‚úÖ Chat ID obtained: ${data.chat_id}`);
                } else {
                    alert(lang === 'es'
                        ? `‚ö†Ô∏è ${data.message || data.error || 'No se encontraron mensajes. Env√≠a un mensaje a tu bot primero.'}`
                        : `‚ö†Ô∏è ${data.message || data.error || 'No messages found. Send a message to your bot first.'}`);
                }
            } catch (error) {
                console.error('Error getting chat ID:', error);
                alert(lang === 'es'
                    ? '‚ùå Error obteniendo Chat ID. Verifica el token.'
                    : '‚ùå Error getting Chat ID. Verify the token.');
            }
        }

        // Enviar mensaje de prueba desde el modal
        async function sendModalTestMessage() {
            const botToken = document.getElementById('modal_bot_token').value.trim();
            const chatId = document.getElementById('modal_chat_id').value.trim();
            const lang = localStorage.getItem('language') || 'en';
            
            if (!botToken || !chatId) {
                alert(lang === 'es' ? 'Por favor ingresa el token y chat ID' : 'Please enter token and chat ID');
                return;
            }
            
            try {
                const response = await fetch('/api/telegram/send-test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        bot_token: botToken,
                        chat_id: chatId
                    })
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    alert(lang === 'es' 
                        ? '‚úÖ Mensaje enviado correctamente. ¬°Revisa tu chat de Telegram!' 
                        : '‚úÖ Message sent successfully. Check your Telegram chat!');
                } else {
                    alert(lang === 'es' 
                        ? `‚ùå Error: ${result.description}` 
                        : `‚ùå Error: ${result.description}`);
                }
            } catch (error) {
                console.error('Error sending test message:', error);
                alert(lang === 'es' 
                    ? '‚ùå Error de conexi√≥n: ' + error.message + '. Verifica el token y Chat ID.' 
                    : '‚ùå Connection error: ' + error.message + '. Verify token and Chat ID.');
            }
        }
        
        // ==================== DATA GENERATOR ====================
        
        // ==================== NO DISCLAIMER FOR SIGNAL BOT ====================
        document.addEventListener('DOMContentLoaded', function() {
            // NO DISCLAIMER NEEDED FOR SIGNAL BOT
        });
    </script>

    <!-- Sistema de gesti√≥n de suscripciones -->
    <script src="/static/js/subscription_manager.js"></script>

    <!-- Footer con cr√©dito del autor -->
    <footer style="text-align: center; padding: 20px; background-color: #0f3460; color: #eee; margin-top: 50px; font-size: 0.9em;">
        <p style="margin: 0;">Este software fue creado por <strong>camiloeagiraldodev@gmail.com</strong></p>
    </footer>

    <script>
        /* MEN√ö UNIVERSAL JAVASCRIPT INLINE */
        function toggleUniversalMenu() {
            const menu = document.getElementById('universalMenu');
            if (menu) {
                menu.classList.toggle('active');
            }
        }
        document.addEventListener('click', function(event) {
            const menu = document.querySelector('.universal-menu');
            const menuContent = document.getElementById('universalMenu');
            if (menu && menuContent && !menu.contains(event.target)) {
                menuContent.classList.remove('active');
            }
        });
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/api/auth/me')
                .then(res => res.json())
                .then(data => {
                    if (data.success && data.user && data.user.role === 'admin') {
                        const adminLink = document.getElementById('adminMenuLink');
                        if (adminLink) adminLink.style.display = 'block';
                    }
                })
                .catch(err => console.error('Error verificando rol:', err));
        });
        /* FIN MEN√ö UNIVERSAL */
    </script>
</body>
</html>

